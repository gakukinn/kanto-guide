<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½å†…å®¹è§£æå™¨æµ‹è¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-6xl mx-auto bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-2xl font-bold mb-6 text-center">ğŸ† æ™ºèƒ½å†…å®¹è§£æå™¨æµ‹è¯•</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- è¾“å…¥åŒºåŸŸ -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    ç²˜è´´èŠ±ç«æ´»åŠ¨ä¿¡æ¯ï¼š
                </label>
                <textarea 
                    id="testContent" 
                    rows="15"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 text-sm"
                    placeholder="ç²˜è´´æ´»åŠ¨è¯¦ç»†ä¿¡æ¯..."
                >å¤§ä¼šåï¼ˆæ´»åŠ¨åç§°ï¼‰	å¸‚åˆ¶70å‘¨å¹´è¨˜å¿µ ç¬¬79å› ã‚ã¤ãé®ã¾ã¤ã‚Š
æ‰“ã¡ä¸Šã’æ•°ï¼ˆèŠ±ç«æ•°ï¼‰	ç´„1ä¸‡ç™ºã€€
æ‰“ã¡ä¸Šã’æ™‚é–“ï¼ˆèŠ±ç«æ—¶é—´ï¼‰	60åˆ†
ä¾‹å¹´ã®äººå‡ºï¼ˆå¾€å¹´è§‚ä¼—æ•°ï¼‰	ç´„28ä¸‡äººã€€
é–‹å‚¬æœŸé–“ï¼ˆä¸¾åŠæ—¥æœŸï¼‰	2025å¹´8æœˆ2æ—¥(åœŸ)
é–‹å‚¬æ™‚é–“	ï¼ˆæ´»åŠ¨æ—¶é—´ï¼‰19:00ï½20:00
è’å¤©ã®å ´åˆï¼ˆæ¶åŠ£å¤©æ°”ï¼‰	é›¨å¤©æ±ºè¡Œã€‚è’å¤©æ™‚ã¯ä¸­æ­¢
æœ‰æ–™å¸­	ã‚ã‚Šï¼ˆæœ‰ä»˜è´¹åº§ä½ï¼‰
æœ‰æ–™è¦³è¦§å¸­ã«ã¤ãã¾ã—ã¦ã¯å…¬å¼ã‚µã‚¤ãƒˆã‚’ã”ç¢ºèªãã ã•ã„ã€‚
å±‹å°ãªã©	ã‚ã‚Šï¼ˆæœ‰å°åƒæ‘Šï¼‰
ã‚¹ãƒãƒƒãƒˆæƒ…å ±ï¼ˆæ™¯ç‚¹ä¿¡æ¯ï¼‰
ä¼šå ´ï¼ˆåœ°ç‚¹ï¼‰	ç›¸æ¨¡å·æ²³å·æ•·(ä¸‰å·åˆæµç‚¹)
ä¼šå ´ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆæŠµè¾¾æ–¹å¼ï¼‰	ã€é›»è»Šã€‘å°ç”°æ€¥å°ç”°åŸç·šæœ¬åšæœ¨é§…åŒ—å£ã‹ã‚‰å¾’æ­©15åˆ†MAP
é§è»Šå ´ï¼ˆåœè½¦åœºï¼‰	Ã—
å•ã„åˆã‚ã›ï¼ˆè”ç³»æ–¹å¼ï¼‰	080-7826-4362 ã‚ã¤ãé®ã¾ã¤ã‚Šå®Ÿè¡Œå§”å“¡ä¼š
å…¬å¼ã‚µã‚¤ãƒˆï¼ˆå®˜æ–¹ç½‘ç«™ï¼‰	å…¬å¼ã‚µã‚¤ãƒˆã»ã‹ã€é–¢é€£ã‚µã‚¤ãƒˆã¯ã“ã¡ã‚‰</textarea>
                
                <button 
                    onclick="testParse()" 
                    class="mt-3 w-full bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors"
                >
                    ğŸ§  æ™ºèƒ½è§£æ
                </button>
                
                <div id="status" class="mt-3 text-sm text-gray-500"></div>
            </div>
            
            <!-- ç»“æœæ˜¾ç¤º -->
            <div>
                <h3 class="text-lg font-semibold mb-3">è§£æç»“æœï¼š</h3>
                <div id="results" class="bg-gray-50 p-4 rounded-lg space-y-2 text-sm max-h-96 overflow-y-auto"></div>
                
                <div class="mt-4">
                    <div class="bg-blue-50 p-3 rounded-lg">
                        <div class="text-blue-800 font-semibold">ç½®ä¿¡åº¦è¯„åˆ†</div>
                        <div id="confidence" class="text-blue-600 text-lg font-bold">-</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- å­—æ®µå¯¹æ¯”è¡¨æ ¼ -->
        <div class="mt-8">
            <h3 class="text-lg font-semibold mb-4">ğŸ“‹ å­—æ®µè¯†åˆ«è¯¦æƒ…</h3>
            <div class="overflow-x-auto">
                <table class="w-full border border-gray-200 rounded-lg">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">å­—æ®µ</th>
                            <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">åŸå§‹æ•°æ®</th>
                            <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">è¯†åˆ«ç»“æœ</th>
                            <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">çŠ¶æ€</th>
                        </tr>
                    </thead>
                    <tbody id="fieldComparison" class="divide-y divide-gray-200">
                        <!-- åŠ¨æ€å¡«å…… -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const expectedFields = [
            { key: 'name', label: 'æ´»åŠ¨åç§°', original: 'å¸‚åˆ¶70å‘¨å¹´è¨˜å¿µ ç¬¬79å› ã‚ã¤ãé®ã¾ã¤ã‚Š' },
            { key: 'fireworksCount', label: 'èŠ±ç«æ•°é‡', original: 'ç´„1ä¸‡ç™º' },
            { key: 'duration', label: 'èŠ±ç«æ—¶é—´', original: '60åˆ†' },
            { key: 'expectedVisitors', label: 'è§‚ä¼—æ•°é‡', original: 'ç´„28ä¸‡äºº' },
            { key: 'date', label: 'ä¸¾åŠæ—¥æœŸ', original: '2025å¹´8æœˆ2æ—¥(åœŸ)' },
            { key: 'startTime', label: 'å¼€å§‹æ—¶é—´', original: '19:00' },
            { key: 'endTime', label: 'ç»“æŸæ—¶é—´', original: '20:00' },
            { key: 'weather', label: 'å¤©æ°”å¤‡æ¡ˆ', original: 'é›¨å¤©æ±ºè¡Œã€‚è’å¤©æ™‚ã¯ä¸­æ­¢' },
            { key: 'ticketInfo', label: 'ç¥¨åŠ¡ä¿¡æ¯', original: 'ã‚ã‚Šï¼ˆæœ‰ä»˜è´¹åº§ä½ï¼‰' },
            { key: 'venue', label: 'ä¼šåœº', original: 'ç›¸æ¨¡å·æ²³å·æ•·(ä¸‰å·åˆæµç‚¹)' },
            { key: 'access', label: 'äº¤é€šæ–¹å¼', original: 'ã€é›»è»Šã€‘å°ç”°æ€¥å°ç”°åŸç·šæœ¬åšæœ¨é§…åŒ—å£ã‹ã‚‰å¾’æ­©15åˆ†MAP' },
            { key: 'parking', label: 'åœè½¦åœº', original: 'Ã—' },
            { key: 'contactPhone', label: 'è”ç³»ç”µè¯', original: '080-7826-4362' }
        ];

        async function testParse() {
            const content = document.getElementById('testContent').value;
            const statusEl = document.getElementById('status');
            const resultsEl = document.getElementById('results');
            const confidenceEl = document.getElementById('confidence');
            const comparisonEl = document.getElementById('fieldComparison');
            
            if (!content.trim()) {
                statusEl.textContent = 'è¯·è¾“å…¥å†…å®¹';
                statusEl.className = 'mt-3 text-sm text-red-500';
                return;
            }
            
            statusEl.textContent = 'è§£æä¸­...';
            statusEl.className = 'mt-3 text-sm text-blue-500';
            
            try {
                // æ¨¡æ‹Ÿæ™ºèƒ½è§£æè¿‡ç¨‹
                const parsedData = parseContent(content);
                
                // æ˜¾ç¤ºç»“æœ
                statusEl.textContent = 'è§£æå®Œæˆï¼';
                statusEl.className = 'mt-3 text-sm text-green-500';
                
                // æ ¼å¼åŒ–æ˜¾ç¤ºè§£æç»“æœ
                let resultHtml = '';
                for (const [key, value] of Object.entries(parsedData)) {
                    if (value) {
                        const label = getFieldLabel(key);
                        resultHtml += `
                            <div class="flex justify-between items-start">
                                <span class="font-medium text-gray-700">${label}:</span>
                                <span class="text-gray-900 ml-2 text-right flex-1">${value}</span>
                            </div>
                        `;
                    }
                }
                resultsEl.innerHTML = resultHtml || '<div class="text-gray-500">æœªè¯†åˆ«åˆ°å­—æ®µ</div>';
                
                // è®¡ç®—ç½®ä¿¡åº¦
                const confidence = calculateConfidence(parsedData);
                confidenceEl.textContent = `${confidence}%`;
                confidenceEl.className = confidence >= 80 ? 'text-green-600 text-lg font-bold' : 
                                         confidence >= 60 ? 'text-yellow-600 text-lg font-bold' : 
                                         'text-red-600 text-lg font-bold';
                
                // æ›´æ–°å­—æ®µå¯¹æ¯”è¡¨æ ¼
                updateFieldComparison(parsedData);
                
            } catch (error) {
                statusEl.textContent = `è§£æå¤±è´¥: ${error.message}`;
                statusEl.className = 'mt-3 text-sm text-red-500';
                resultsEl.textContent = `é”™è¯¯: ${error.message}`;
            }
        }
        
        function parseContent(content) {
            const result = {};
            const lines = content.split('\n').filter(line => line.trim());
            
            for (const line of lines) {
                // æ´»åŠ¨åç§°
                if (line.includes('å¤§ä¼šå') || line.includes('æ´»åŠ¨åç§°')) {
                    const match = line.match(/(?:å¤§ä¼šå|æ´»åŠ¨åç§°)(?:ï¼š|:|\t|ã€€)+(.+)/);
                    if (match) result.name = match[1].trim();
                }
                
                // èŠ±ç«æ•°é‡
                if (line.includes('æ‰“ã¡ä¸Šã’æ•°') || line.includes('èŠ±ç«æ•°')) {
                    const match = line.match(/(?:æ‰“ã¡ä¸Šã’æ•°|èŠ±ç«æ•°)(?:ï¼š|:|\t|ã€€)+(.+)/);
                    if (match) result.fireworksCount = match[1].trim();
                }
                
                // èŠ±ç«æ—¶é—´
                if (line.includes('æ‰“ã¡ä¸Šã’æ™‚é–“') || line.includes('èŠ±ç«æ—¶é—´')) {
                    const match = line.match(/(?:æ‰“ã¡ä¸Šã’æ™‚é–“|èŠ±ç«æ—¶é—´)(?:ï¼š|:|\t|ã€€)+(.+)/);
                    if (match) result.duration = match[1].trim();
                }
                
                // è§‚ä¼—æ•°é‡
                if (line.includes('ä¾‹å¹´ã®äººå‡º') || line.includes('è§‚ä¼—æ•°')) {
                    const match = line.match(/(?:ä¾‹å¹´ã®äººå‡º|è§‚ä¼—æ•°)(?:ï¼š|:|\t|ã€€)+(.+)/);
                    if (match) result.expectedVisitors = match[1].trim();
                }
                
                // ä¸¾åŠæ—¥æœŸ
                if (line.includes('é–‹å‚¬æœŸé–“') || line.includes('ä¸¾åŠæ—¥æœŸ')) {
                    const match = line.match(/(?:é–‹å‚¬æœŸé–“|ä¸¾åŠæ—¥æœŸ)(?:ï¼š|:|\t|ã€€)+(.+)/);
                    if (match) {
                        const dateStr = match[1].trim();
                        // è§£ææ—¥æœŸæ ¼å¼
                        const dateMatch = dateStr.match(/(\d{4})å¹´(\d{1,2})æœˆ(\d{1,2})æ—¥/);
                        if (dateMatch) {
                            const year = dateMatch[1];
                            const month = dateMatch[2].padStart(2, '0');
                            const day = dateMatch[3].padStart(2, '0');
                            result.date = `${year}-${month}-${day}`;
                        } else {
                            result.date = dateStr;
                        }
                    }
                }
                
                // æ´»åŠ¨æ—¶é—´
                if (line.includes('é–‹å‚¬æ™‚é–“') || line.includes('æ´»åŠ¨æ—¶é—´')) {
                    const match = line.match(/(?:é–‹å‚¬æ™‚é–“|æ´»åŠ¨æ—¶é—´)(?:ï¼š|:|\t|ã€€)+(.+)/);
                    if (match) {
                        const timeStr = match[1].trim();
                        // è§£ææ—¶é—´æ ¼å¼ 19:00ï½20:00
                        const timeMatch = timeStr.match(/(\d{1,2}):(\d{2})\s*[ï½~-]\s*(\d{1,2}):(\d{2})/);
                        if (timeMatch) {
                            result.startTime = `${timeMatch[1].padStart(2, '0')}:${timeMatch[2]}`;
                            result.endTime = `${timeMatch[3].padStart(2, '0')}:${timeMatch[4]}`;
                        }
                    }
                }
                
                // å¤©æ°”å¤‡æ¡ˆ
                if (line.includes('è’å¤©ã®å ´åˆ') || line.includes('æ¶åŠ£å¤©æ°”')) {
                    const match = line.match(/(?:è’å¤©ã®å ´åˆ|æ¶åŠ£å¤©æ°”)(?:ï¼š|:|\t|ã€€)+(.+)/);
                    if (match) result.weather = match[1].trim();
                }
                
                // ç¥¨åŠ¡ä¿¡æ¯
                if (line.includes('æœ‰æ–™å¸­') || line.includes('ä»˜è´¹åº§ä½')) {
                    const match = line.match(/(?:æœ‰æ–™å¸­|ä»˜è´¹åº§ä½)(?:ï¼š|:|\t|ã€€)+(.+)/);
                    if (match) result.ticketInfo = match[1].trim();
                }
                
                // ä¼šåœº
                if (line.includes('ä¼šå ´') && (line.includes('åœ°ç‚¹') || line.includes('ï¼ˆåœ°ç‚¹ï¼‰'))) {
                    const match = line.match(/ä¼šå ´(?:\ï¼ˆåœ°ç‚¹\ï¼‰)?(?:ï¼š|:|\t|ã€€)+(.+)/);
                    if (match) result.venue = match[1].trim();
                }
                
                // äº¤é€šæ–¹å¼
                if (line.includes('ä¼šå ´ã‚¢ã‚¯ã‚»ã‚¹') || line.includes('æŠµè¾¾æ–¹å¼')) {
                    const match = line.match(/(?:ä¼šå ´ã‚¢ã‚¯ã‚»ã‚¹|æŠµè¾¾æ–¹å¼)(?:ï¼š|:|\t|ã€€)+(.+)/);
                    if (match) result.access = match[1].trim();
                }
                
                // åœè½¦åœº
                if (line.includes('é§è»Šå ´') || line.includes('åœè½¦åœº')) {
                    const match = line.match(/(?:é§è»Šå ´|åœè½¦åœº)(?:ï¼š|:|\t|ã€€)+(.+)/);
                    if (match) result.parking = match[1].trim();
                }
                
                // è”ç³»æ–¹å¼
                if (line.includes('å•ã„åˆã‚ã›') || line.includes('è”ç³»æ–¹å¼')) {
                    const phoneMatch = line.match(/(\d{3}-\d{4}-\d{4})/);
                    if (phoneMatch) result.contactPhone = phoneMatch[1];
                }
            }
            
            return result;
        }
        
        function getFieldLabel(key) {
            const labels = {
                name: 'æ´»åŠ¨åç§°',
                fireworksCount: 'èŠ±ç«æ•°é‡',
                duration: 'æŒç»­æ—¶é—´',
                expectedVisitors: 'é¢„è®¡è§‚ä¼—',
                date: 'ä¸¾åŠæ—¥æœŸ',
                startTime: 'å¼€å§‹æ—¶é—´',
                endTime: 'ç»“æŸæ—¶é—´',
                weather: 'å¤©æ°”å¤‡æ¡ˆ',
                ticketInfo: 'ç¥¨åŠ¡ä¿¡æ¯',
                venue: 'ä¼šåœº',
                access: 'äº¤é€šæ–¹å¼',
                parking: 'åœè½¦åœº',
                contactPhone: 'è”ç³»ç”µè¯'
            };
            return labels[key] || key;
        }
        
        function calculateConfidence(data) {
            const weights = {
                name: 20,
                date: 20,
                venue: 15,
                fireworksCount: 10,
                expectedVisitors: 10,
                access: 10,
                startTime: 5,
                endTime: 5,
                contactPhone: 5
            };
            
            let score = 0;
            let maxScore = 0;
            
            for (const [field, weight] of Object.entries(weights)) {
                maxScore += weight;
                if (data[field]) {
                    score += weight;
                }
            }
            
            return Math.round((score / maxScore) * 100);
        }
        
        function updateFieldComparison(parsedData) {
            const comparisonEl = document.getElementById('fieldComparison');
            let html = '';
            
            for (const field of expectedFields) {
                const recognized = parsedData[field.key];
                const status = recognized ? 'âœ… è¯†åˆ«æˆåŠŸ' : 'âŒ æœªè¯†åˆ«';
                const statusClass = recognized ? 'text-green-600' : 'text-red-600';
                
                html += `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-2 font-medium text-gray-900">${field.label}</td>
                        <td class="px-4 py-2 text-gray-600 text-sm">${field.original}</td>
                        <td class="px-4 py-2 text-gray-900 text-sm">${recognized || '-'}</td>
                        <td class="px-4 py-2 text-sm ${statusClass}">${status}</td>
                    </tr>
                `;
            }
            
            comparisonEl.innerHTML = html;
        }
        
        // é¡µé¢åŠ è½½åè‡ªåŠ¨æµ‹è¯•
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(testParse, 1000);
        });
    </script>
</body>
</html> 