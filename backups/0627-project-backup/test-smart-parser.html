<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能内容解析器测试</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-6xl mx-auto bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-2xl font-bold mb-6 text-center">🎆 智能内容解析器测试</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- 输入区域 -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    粘贴花火活动信息：
                </label>
                <textarea 
                    id="testContent" 
                    rows="15"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 text-sm"
                    placeholder="粘贴活动详细信息..."
                >大会名（活动名称）	市制70周年記念 第79回 あつぎ鮎まつり
打ち上げ数（花火数）	約1万発　
打ち上げ時間（花火时间）	60分
例年の人出（往年观众数）	約28万人　
開催期間（举办日期）	2025年8月2日(土)
開催時間	（活动时间）19:00～20:00
荒天の場合（恶劣天气）	雨天決行。荒天時は中止
有料席	あり（有付费座位）
有料観覧席につきましては公式サイトをご確認ください。
屋台など	あり（有小吃摊）
スポット情報（景点信息）
会場（地点）	相模川河川敷(三川合流点)
会場アクセス（抵达方式）	【電車】小田急小田原線本厚木駅北口から徒歩15分MAP
駐車場（停车场）	×
問い合わせ（联系方式）	080-7826-4362 あつぎ鮎まつり実行委員会
公式サイト（官方网站）	公式サイトほか、関連サイトはこちら</textarea>
                
                <button 
                    onclick="testParse()" 
                    class="mt-3 w-full bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors"
                >
                    🧠 智能解析
                </button>
                
                <div id="status" class="mt-3 text-sm text-gray-500"></div>
            </div>
            
            <!-- 结果显示 -->
            <div>
                <h3 class="text-lg font-semibold mb-3">解析结果：</h3>
                <div id="results" class="bg-gray-50 p-4 rounded-lg space-y-2 text-sm max-h-96 overflow-y-auto"></div>
                
                <div class="mt-4">
                    <div class="bg-blue-50 p-3 rounded-lg">
                        <div class="text-blue-800 font-semibold">置信度评分</div>
                        <div id="confidence" class="text-blue-600 text-lg font-bold">-</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 字段对比表格 -->
        <div class="mt-8">
            <h3 class="text-lg font-semibold mb-4">📋 字段识别详情</h3>
            <div class="overflow-x-auto">
                <table class="w-full border border-gray-200 rounded-lg">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">字段</th>
                            <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">原始数据</th>
                            <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">识别结果</th>
                            <th class="px-4 py-2 text-left text-sm font-semibold text-gray-700">状态</th>
                        </tr>
                    </thead>
                    <tbody id="fieldComparison" class="divide-y divide-gray-200">
                        <!-- 动态填充 -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const expectedFields = [
            { key: 'name', label: '活动名称', original: '市制70周年記念 第79回 あつぎ鮎まつり' },
            { key: 'fireworksCount', label: '花火数量', original: '約1万発' },
            { key: 'duration', label: '花火时间', original: '60分' },
            { key: 'expectedVisitors', label: '观众数量', original: '約28万人' },
            { key: 'date', label: '举办日期', original: '2025年8月2日(土)' },
            { key: 'startTime', label: '开始时间', original: '19:00' },
            { key: 'endTime', label: '结束时间', original: '20:00' },
            { key: 'weather', label: '天气备案', original: '雨天決行。荒天時は中止' },
            { key: 'ticketInfo', label: '票务信息', original: 'あり（有付费座位）' },
            { key: 'venue', label: '会场', original: '相模川河川敷(三川合流点)' },
            { key: 'access', label: '交通方式', original: '【電車】小田急小田原線本厚木駅北口から徒歩15分MAP' },
            { key: 'parking', label: '停车场', original: '×' },
            { key: 'contactPhone', label: '联系电话', original: '080-7826-4362' }
        ];

        async function testParse() {
            const content = document.getElementById('testContent').value;
            const statusEl = document.getElementById('status');
            const resultsEl = document.getElementById('results');
            const confidenceEl = document.getElementById('confidence');
            const comparisonEl = document.getElementById('fieldComparison');
            
            if (!content.trim()) {
                statusEl.textContent = '请输入内容';
                statusEl.className = 'mt-3 text-sm text-red-500';
                return;
            }
            
            statusEl.textContent = '解析中...';
            statusEl.className = 'mt-3 text-sm text-blue-500';
            
            try {
                // 模拟智能解析过程
                const parsedData = parseContent(content);
                
                // 显示结果
                statusEl.textContent = '解析完成！';
                statusEl.className = 'mt-3 text-sm text-green-500';
                
                // 格式化显示解析结果
                let resultHtml = '';
                for (const [key, value] of Object.entries(parsedData)) {
                    if (value) {
                        const label = getFieldLabel(key);
                        resultHtml += `
                            <div class="flex justify-between items-start">
                                <span class="font-medium text-gray-700">${label}:</span>
                                <span class="text-gray-900 ml-2 text-right flex-1">${value}</span>
                            </div>
                        `;
                    }
                }
                resultsEl.innerHTML = resultHtml || '<div class="text-gray-500">未识别到字段</div>';
                
                // 计算置信度
                const confidence = calculateConfidence(parsedData);
                confidenceEl.textContent = `${confidence}%`;
                confidenceEl.className = confidence >= 80 ? 'text-green-600 text-lg font-bold' : 
                                         confidence >= 60 ? 'text-yellow-600 text-lg font-bold' : 
                                         'text-red-600 text-lg font-bold';
                
                // 更新字段对比表格
                updateFieldComparison(parsedData);
                
            } catch (error) {
                statusEl.textContent = `解析失败: ${error.message}`;
                statusEl.className = 'mt-3 text-sm text-red-500';
                resultsEl.textContent = `错误: ${error.message}`;
            }
        }
        
        function parseContent(content) {
            const result = {};
            const lines = content.split('\n').filter(line => line.trim());
            
            for (const line of lines) {
                // 活动名称
                if (line.includes('大会名') || line.includes('活动名称')) {
                    const match = line.match(/(?:大会名|活动名称)(?:：|:|\t|　)+(.+)/);
                    if (match) result.name = match[1].trim();
                }
                
                // 花火数量
                if (line.includes('打ち上げ数') || line.includes('花火数')) {
                    const match = line.match(/(?:打ち上げ数|花火数)(?:：|:|\t|　)+(.+)/);
                    if (match) result.fireworksCount = match[1].trim();
                }
                
                // 花火时间
                if (line.includes('打ち上げ時間') || line.includes('花火时间')) {
                    const match = line.match(/(?:打ち上げ時間|花火时间)(?:：|:|\t|　)+(.+)/);
                    if (match) result.duration = match[1].trim();
                }
                
                // 观众数量
                if (line.includes('例年の人出') || line.includes('观众数')) {
                    const match = line.match(/(?:例年の人出|观众数)(?:：|:|\t|　)+(.+)/);
                    if (match) result.expectedVisitors = match[1].trim();
                }
                
                // 举办日期
                if (line.includes('開催期間') || line.includes('举办日期')) {
                    const match = line.match(/(?:開催期間|举办日期)(?:：|:|\t|　)+(.+)/);
                    if (match) {
                        const dateStr = match[1].trim();
                        // 解析日期格式
                        const dateMatch = dateStr.match(/(\d{4})年(\d{1,2})月(\d{1,2})日/);
                        if (dateMatch) {
                            const year = dateMatch[1];
                            const month = dateMatch[2].padStart(2, '0');
                            const day = dateMatch[3].padStart(2, '0');
                            result.date = `${year}-${month}-${day}`;
                        } else {
                            result.date = dateStr;
                        }
                    }
                }
                
                // 活动时间
                if (line.includes('開催時間') || line.includes('活动时间')) {
                    const match = line.match(/(?:開催時間|活动时间)(?:：|:|\t|　)+(.+)/);
                    if (match) {
                        const timeStr = match[1].trim();
                        // 解析时间格式 19:00～20:00
                        const timeMatch = timeStr.match(/(\d{1,2}):(\d{2})\s*[～~-]\s*(\d{1,2}):(\d{2})/);
                        if (timeMatch) {
                            result.startTime = `${timeMatch[1].padStart(2, '0')}:${timeMatch[2]}`;
                            result.endTime = `${timeMatch[3].padStart(2, '0')}:${timeMatch[4]}`;
                        }
                    }
                }
                
                // 天气备案
                if (line.includes('荒天の場合') || line.includes('恶劣天气')) {
                    const match = line.match(/(?:荒天の場合|恶劣天气)(?:：|:|\t|　)+(.+)/);
                    if (match) result.weather = match[1].trim();
                }
                
                // 票务信息
                if (line.includes('有料席') || line.includes('付费座位')) {
                    const match = line.match(/(?:有料席|付费座位)(?:：|:|\t|　)+(.+)/);
                    if (match) result.ticketInfo = match[1].trim();
                }
                
                // 会场
                if (line.includes('会場') && (line.includes('地点') || line.includes('（地点）'))) {
                    const match = line.match(/会場(?:\（地点\）)?(?:：|:|\t|　)+(.+)/);
                    if (match) result.venue = match[1].trim();
                }
                
                // 交通方式
                if (line.includes('会場アクセス') || line.includes('抵达方式')) {
                    const match = line.match(/(?:会場アクセス|抵达方式)(?:：|:|\t|　)+(.+)/);
                    if (match) result.access = match[1].trim();
                }
                
                // 停车场
                if (line.includes('駐車場') || line.includes('停车场')) {
                    const match = line.match(/(?:駐車場|停车场)(?:：|:|\t|　)+(.+)/);
                    if (match) result.parking = match[1].trim();
                }
                
                // 联系方式
                if (line.includes('問い合わせ') || line.includes('联系方式')) {
                    const phoneMatch = line.match(/(\d{3}-\d{4}-\d{4})/);
                    if (phoneMatch) result.contactPhone = phoneMatch[1];
                }
            }
            
            return result;
        }
        
        function getFieldLabel(key) {
            const labels = {
                name: '活动名称',
                fireworksCount: '花火数量',
                duration: '持续时间',
                expectedVisitors: '预计观众',
                date: '举办日期',
                startTime: '开始时间',
                endTime: '结束时间',
                weather: '天气备案',
                ticketInfo: '票务信息',
                venue: '会场',
                access: '交通方式',
                parking: '停车场',
                contactPhone: '联系电话'
            };
            return labels[key] || key;
        }
        
        function calculateConfidence(data) {
            const weights = {
                name: 20,
                date: 20,
                venue: 15,
                fireworksCount: 10,
                expectedVisitors: 10,
                access: 10,
                startTime: 5,
                endTime: 5,
                contactPhone: 5
            };
            
            let score = 0;
            let maxScore = 0;
            
            for (const [field, weight] of Object.entries(weights)) {
                maxScore += weight;
                if (data[field]) {
                    score += weight;
                }
            }
            
            return Math.round((score / maxScore) * 100);
        }
        
        function updateFieldComparison(parsedData) {
            const comparisonEl = document.getElementById('fieldComparison');
            let html = '';
            
            for (const field of expectedFields) {
                const recognized = parsedData[field.key];
                const status = recognized ? '✅ 识别成功' : '❌ 未识别';
                const statusClass = recognized ? 'text-green-600' : 'text-red-600';
                
                html += `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-2 font-medium text-gray-900">${field.label}</td>
                        <td class="px-4 py-2 text-gray-600 text-sm">${field.original}</td>
                        <td class="px-4 py-2 text-gray-900 text-sm">${recognized || '-'}</td>
                        <td class="px-4 py-2 text-sm ${statusClass}">${status}</td>
                    </tr>
                `;
            }
            
            comparisonEl.innerHTML = html;
        }
        
        // 页面加载后自动测试
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(testParse, 1000);
        });
    </script>
</body>
</html> 