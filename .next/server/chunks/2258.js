"use strict";exports.id=2258,exports.ids=[2258],exports.modules={12258:(t,e,r)=>{r.a(t,async(t,a)=>{try{r.d(e,{MatsuriCrawler:()=>o});var s=r(72430),i=r(49667),n=t([i]);i=(n.then?(await n)():n)[0];class o{constructor(){this.results=[],this.errors=[],this.crawler=new i.PlaywrightCrawler({headless:!0,requestHandler:async({page:t,request:e,log:r})=>{try{r.info(`Processing: ${e.url}`),await t.waitForLoadState("networkidle"),e.url.includes("omaturilink.com")?await this.scrapeOmaturiLink(t):e.url.includes("matcha-jp.com")?await this.scrapeMatcha(t):e.url.includes("on-japan.jp")&&await this.scrapeRealJapanOn(t)}catch(t){this.errors.push(`Error processing ${e.url}: ${t instanceof Error?t.message:String(t)}`)}},failedRequestHandler:async({request:t,error:e})=>{this.errors.push(`Failed to process ${t.url}: ${e instanceof Error?e.message:String(e)}`)}})}async scrapeOmaturiLink(t){(await t.evaluate(()=>{let t=[];return document.querySelectorAll(".festival-item, .event-item, .matsuri-item").forEach(e=>{try{let r=e.querySelector(".title, .name, h3, h2")?.textContent?.trim(),a=e.querySelector(".date, .time")?.textContent?.trim(),s=e.querySelector(".location, .place")?.textContent?.trim(),i=e.querySelector(".description, .summary")?.textContent?.trim();r&&a&&s&&t.push({title:r,date:a,location:s,description:i||"",source:window.location.href})}catch(t){console.error("Error parsing festival item:",t)}}),t})).forEach((t,e)=>{try{let e=this.processFestivalData(t,"omaturilink.com");this.results.push(e)}catch(t){this.errors.push(`Error processing festival ${e}: ${t instanceof Error?t.message:String(t)}`)}})}async scrapeMatcha(t){(await t.evaluate(()=>{let t=[];return document.querySelectorAll("article, .article-item, .event-card").forEach(e=>{try{let r=e.querySelector("h1, h2, h3, .title")?.textContent?.trim(),a=e.querySelector(".content, .description, p")?.textContent?.trim(),s=a?.match(/(\d{4})年(\d{1,2})月(\d{1,2})日/),i=a?.match(/(神社|寺|会場|公園|駅|区|市)/);r&&s&&t.push({title:r,date:`${s[1]}-${s[2].padStart(2,"0")}-${s[3].padStart(2,"0")}`,location:i?i[0]:"東京都内",description:a||"",source:window.location.href})}catch(t){console.error("Error parsing MATCHA item:",t)}}),t})).forEach((t,e)=>{try{let e=this.processFestivalData(t,"matcha-jp.com");this.results.push(e)}catch(t){this.errors.push(`Error processing MATCHA festival ${e}: ${t instanceof Error?t.message:String(t)}`)}})}async scrapeRealJapanOn(t){(await t.evaluate(()=>{let t=[];return document.querySelectorAll(".festival-card, .event-info, .matsuri-info").forEach(e=>{try{let r=e.querySelector(".festival-name, .event-title, h3")?.textContent?.trim(),a=e.querySelector(".date, .schedule")?.textContent?.trim(),s=e.querySelector(".venue, .location")?.textContent?.trim(),i=e.querySelector(".description, .summary")?.textContent?.trim();r&&t.push({title:r,date:a||"",location:s||"東京都内",description:i||"",source:window.location.href})}catch(t){console.error("Error parsing Real Japan item:",t)}}),t})).forEach((t,e)=>{try{let e=this.processFestivalData(t,"on-japan.jp");this.results.push(e)}catch(t){this.errors.push(`Error processing Real Japan festival ${e}: ${t instanceof Error?t.message:String(t)}`)}})}processFestivalData(t,e){let r=`${e}-${t.title.replace(/[^a-zA-Z0-9]/g,"-").toLowerCase()}-${Date.now()}`,a=this.standardizeDate(t.date),i=this.inferCategory(t.title,t.description),n=this.extractHighlights(t.title,t.description),o=this.generateWebsiteUrl(t.title),c={id:r,title:t.title,japaneseName:t.title,englishName:this.translateToEnglish(t.title),date:a,location:t.location,category:i,highlights:n,likes:Math.floor(200*Math.random()),website:o,description:t.description,prefecture:"東京都",lastUpdated:new Date().toISOString(),source:t.source,verified:!1};return s.L0.parse(c)}standardizeDate(t){if(!t)return new Date().toISOString().split("T")[0];for(let e of[/(\d{4})年(\d{1,2})月(\d{1,2})日/,/(\d{4})-(\d{1,2})-(\d{1,2})/,/(\d{1,2})\/(\d{1,2})\/(\d{4})/]){let r=t.match(e);if(r){let[,t,e,a]=r;return`${t}-${e.padStart(2,"0")}-${a.padStart(2,"0")}`}}return new Date().toISOString().split("T")[0]}inferCategory(t,e){let r=`${t} ${e}`.toLowerCase();return r.includes("大祭")||r.includes("花火大会")||r.includes("大規模")?"大型":r.includes("地域")||r.includes("小規模")||r.includes("地元")?"小型":"中型"}extractHighlights(t,e){let r=[],a=`${t} ${e}`;return[{pattern:/花火|煙火/,highlight:"花火大会"},{pattern:/神輿|这/,highlight:"神轿游行"},{pattern:/祭|祭典/,highlight:"传统祭典"},{pattern:/踊|舞踊/,highlight:"传统舞蹈"},{pattern:/屋台|出店/,highlight:"美食摊位"},{pattern:/伝統|歴史/,highlight:"历史传统"}].forEach(({pattern:t,highlight:e})=>{t.test(a)&&!r.includes(e)&&r.push(e)}),r.length>0?r:["传统祭典"]}translateToEnglish(t){let e=t;return Object.entries({祭:"Festival",花火大会:"Fireworks Festival",桜祭:"Cherry Blossom Festival",神社:"Shrine",寺:"Temple"}).forEach(([t,r])=>{e=e.replace(RegExp(t,"g"),r)}),e||t}estimateVisitors(t){switch(t){case"大型":return"10万人以上";case"中型":default:return"1-10万人";case"小型":return"1万人以下"}}estimateDuration(t){return t.includes("一日")||t.includes("1日")?"1日":t.includes("週末")||t.includes("土日")?"2日":"3日"}generateWebsiteUrl(t){let e=encodeURIComponent(t);return`https://www.google.com/search?q=${e}+公式网站`}async crawl(t){try{return this.results=[],this.errors=[],await this.crawler.addRequests(t),await this.crawler.run(),{success:0===this.errors.length,data:this.results,errors:this.errors,timestamp:new Date().toISOString(),source:"matsuri-crawler"}}catch(t){return{success:!1,data:[],errors:[`Crawler failed: ${t instanceof Error?t.message:String(t)}`],timestamp:new Date().toISOString(),source:"matsuri-crawler"}}}async cleanup(){await this.crawler.teardown()}}a()}catch(t){a(t)}})}};