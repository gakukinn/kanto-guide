name: æ•°æ®åŒæ­¥å’ŒéªŒè¯

# æ¯å‘¨æ—¥å‡Œæ™¨è‡ªåŠ¨è¿è¡Œï¼Œæˆ–æ‰‹åŠ¨è§¦å‘
on:
  schedule:
    - cron: "0 0 * * 0"  # æ¯å‘¨æ—¥åˆå¤œ
  workflow_dispatch:     # å…è®¸æ‰‹åŠ¨è§¦å‘
  push:
    paths:
      - 'scripts/automated-data-sync.cjs'

jobs:
  sync-data:
    runs-on: ubuntu-latest
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      
    - name: è®¾ç½® Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: å®‰è£…ä¾èµ–
      run: npm install
      
    - name: è¿è¡Œæ•°æ®åŒæ­¥
      run: node scripts/automated-data-sync.cjs
      
    - name: æ£€æŸ¥æ„å»º
      run: npm run build
      
    - name: æäº¤æ›´æ”¹ï¼ˆå¦‚æœæœ‰ï¼‰
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add .
        if git diff --staged --quiet; then
          echo "æ²¡æœ‰æ•°æ®å˜æ›´"
        else
          git commit -m "ğŸ¤– è‡ªåŠ¨åŒæ­¥èŠ±ç«æ•°æ® $(date '+%Y-%m-%d')"
          git push
        fi 