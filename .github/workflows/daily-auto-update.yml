# æ¯æ—¥è‡ªåŠ¨æ›´æ–°å·¥ä½œæµ - ä¸œäº¬æ—¶é—´ä¸­åˆ12ç‚¹æ‰§è¡Œ
name: æ¯æ—¥è‡ªåŠ¨æ›´æ–°

on:
  schedule:
    # æ¯å¤©ä¸œäº¬æ—¶é—´ä¸­åˆ12ç‚¹ï¼ˆUTC 3ç‚¹ï¼‰æ‰§è¡Œ
    - cron: '0 3 * * *'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘
  push:
    branches: [ main ] # å½“æ¨é€åˆ°mainåˆ†æ”¯æ—¶ä¹Ÿè§¦å‘ï¼Œç”¨äºæµ‹è¯•

jobs:
  auto-update:
    runs-on: ubuntu-latest
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      
    - name: è®¾ç½®Node.jsç¯å¢ƒ
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
        
    - name: å®‰è£…ä¾èµ–
      run: |
        echo "ğŸ“¦ æ­£åœ¨å®‰è£…ä¾èµ–..."
        npm ci
        
    - name: æ£€æŸ¥é¡¹ç›®çŠ¶æ€
      run: |
        echo "ğŸ” æ£€æŸ¥é¡¹ç›®æ–‡ä»¶..."
        ls -la
        echo "âœ… é¡¹ç›®çŠ¶æ€æ­£å¸¸"
        echo "ğŸ• å½“å‰æ—¶é—´: $(date)"
        echo "ğŸŒ æ‰§è¡Œä½ç½®: ä¸œäº¬æ—¶é—´ä¸­åˆ12ç‚¹å®šæ—¶ä»»åŠ¡"
        
    - name: æ£€æŸ¥æ˜¯å¦æœ‰å˜æ›´
      id: check-changes
      run: |
        echo "ğŸ“Š æ£€æŸ¥GitçŠ¶æ€..."
        if [ -n "$(git status --porcelain)" ]; then
          echo "has_changes=true" >> $GITHUB_OUTPUT
          echo "âœ… å‘ç°å˜æ›´"
        else
          echo "has_changes=false" >> $GITHUB_OUTPUT
          echo "â„¹ï¸ æ— å˜æ›´"
        fi
        
    - name: æäº¤å˜æ›´ï¼ˆå¦‚æœ‰ï¼‰
      if: steps.check-changes.outputs.has_changes == 'true'
      run: |
        echo "ğŸ’¾ æäº¤å˜æ›´..."
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add .
        git commit -m "ğŸ¤– è‡ªåŠ¨æ›´æ–°: $(date '+%Y-%m-%d %H:%M:%S')"
        git push
        echo "ğŸš€ å˜æ›´å·²æ¨é€ï¼ŒVercelå°†è‡ªåŠ¨éƒ¨ç½²"
        
    - name: å®Œæˆé€šçŸ¥
      run: |
        echo "ğŸ‰ æ¯æ—¥è‡ªåŠ¨æ›´æ–°å®Œæˆ"
        echo "â° ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´: æ˜å¤©ä¸œäº¬æ—¶é—´ä¸­åˆ12ç‚¹" 