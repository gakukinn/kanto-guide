name: Cleanup Old Workflows

on:
  workflow_dispatch: # 只允许手动触发

jobs:
  cleanup:
    runs-on: ubuntu-latest
    
    steps:
    - name: Disable old workflows
      uses: actions/github-script@v7
      with:
        script: |
          console.log('🧹 Starting workflow cleanup...');
          
          // 获取所有工作流
          const workflows = await github.rest.actions.listRepoWorkflows({
            owner: context.repo.owner,
            repo: context.repo.repo,
          });
          
          console.log(`Found ${workflows.data.total_count} workflows`);
          
          // 禁用包含"花火"或"hanabi"的旧工作流
          for (const workflow of workflows.data.workflows) {
            if (workflow.name.includes('花火') || 
                workflow.name.includes('hanabi') || 
                workflow.name.includes('自动更新花火数据库')) {
              
              console.log(`🚫 Disabling workflow: ${workflow.name} (ID: ${workflow.id})`);
              
              try {
                await github.rest.actions.disableWorkflow({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  workflow_id: workflow.id,
                });
                console.log(`✅ Successfully disabled: ${workflow.name}`);
              } catch (error) {
                console.log(`⚠️ Could not disable ${workflow.name}: ${error.message}`);
              }
            }
          }
          
          console.log('🎉 Cleanup completed!'); 