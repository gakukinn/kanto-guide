name: Cleanup Old Workflows

on:
  workflow_dispatch: # åªå…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  cleanup:
    runs-on: ubuntu-latest
    
    steps:
    - name: Disable old workflows
      uses: actions/github-script@v7
      with:
        script: |
          console.log('ğŸ§¹ Starting workflow cleanup...');
          
          // è·å–æ‰€æœ‰å·¥ä½œæµ
          const workflows = await github.rest.actions.listRepoWorkflows({
            owner: context.repo.owner,
            repo: context.repo.repo,
          });
          
          console.log(`Found ${workflows.data.total_count} workflows`);
          
          // ç¦ç”¨åŒ…å«"èŠ±ç«"æˆ–"hanabi"çš„æ—§å·¥ä½œæµ
          for (const workflow of workflows.data.workflows) {
            if (workflow.name.includes('èŠ±ç«') || 
                workflow.name.includes('hanabi') || 
                workflow.name.includes('è‡ªåŠ¨æ›´æ–°èŠ±ç«æ•°æ®åº“')) {
              
              console.log(`ğŸš« Disabling workflow: ${workflow.name} (ID: ${workflow.id})`);
              
              try {
                await github.rest.actions.disableWorkflow({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  workflow_id: workflow.id,
                });
                console.log(`âœ… Successfully disabled: ${workflow.name}`);
              } catch (error) {
                console.log(`âš ï¸ Could not disable ${workflow.name}: ${error.message}`);
              }
            }
          }
          
          console.log('ğŸ‰ Cleanup completed!'); 