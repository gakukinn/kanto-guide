# Kanto Travel Guide 数据验证与操作指南

_文档更新时间: 2025-06-15_  
_文档类型: 数据管理 | 操作规范_

## 📊 数据验证体系

### 数据来源与验证标准

**官方数据来源确认:**

```typescript
// matsuri (祭典) 数据来源
Source: omaturilink.com
Authority: 日本官方祭典信息网站
Validation: 政府机构和文化组织认证
Data Types: 祭典名称、日期、地点、历史背景、文化意义

// hanabi (花火) 数据来源
Source: walkerplus.com
Authority: WalkerPlus官方花火大会数据库
Validation: 观光协会和活动主办方认证
Data Types: 花火发数、观众数量、技术规格、会场信息
```

**数据真实性验证流程:**

```bash
# 1. 数据来源验证
curl -I https://omaturilink.com/event/[event-id]  # 确认页面存在
curl -I https://walkerplus.com/event/[event-id]   # 确认官方链接

# 2. 数据一致性检查
npm run check-quality                              # 运行自动化验证

# 3. 手动验证关键数据
grep -r "expectedVisitors.*[0-9]" src/            # 检查访客数据
grep -r "fireworks.*[0-9]" src/                   # 检查花火数据
```

### 数据结构标准化

**matsuri事件标准结构:**

```typescript
interface MatsuriEvent {
  // 必需字段
  id: string; // 唯一标识符
  title: string; // 事件标题
  name: string; // 显示名称
  date: string; // ISO格式日期 'YYYY-MM-DD'
  dates: string; // 用户友好显示 '2025年7月15日'
  location: string; // 举办城市 '川越市'
  venue: string; // 具体场地 '川越市中心街区'
  highlights: string[]; // 亮点特色 ['🎌 山车巡游', '🎭 传统艺能']
  features: string[]; // 功能特性 (与highlights相同)
  likes: number; // 点赞数 (真实数据)
  website: string; // 官方网站
  description: string; // 详细描述
  category: string; // 事件分类 '山车祭典'
  prefecture: string; // 都道府县 '埼玉县'
  region: string; // 地区代码 'saitama'

  // 可选字段
  endDate?: string; // 结束日期
  englishName?: string; // 英文名称
  _sourceData?: {
    // 原始数据源
    japaneseName: string;
    japaneseDescription: string;
  };
}
```

**hanabi事件标准结构:**

```typescript
interface HanabiEvent extends MatsuriEvent {
  // hanabi专属必需字段
  fireworks: string; // 花火发数 '约2万发'
  expectedVisitors: string; // 预期观众 '50万人'
  dataSource: 'WalkerPlus'; // 固定数据源标注

  // hanabi专属可选字段
  ticketRequired?: boolean; // 是否需要门票
  parkingAvailable?: boolean; // 是否有停车场
  accessInfo?: string; // 交通信息
}
```

### 自动化验证规则

**数据完整性检查:**

```javascript
// 必需字段验证
const validateRequiredFields = (event, type) => {
  const baseRequired = ['id', 'title', 'name', 'date', 'location', 'venue'];
  const matsuriRequired = [...baseRequired, 'highlights', 'category'];
  const hanabiRequired = [...matsuriRequired, 'fireworks', 'expectedVisitors'];

  const required = type === 'matsuri' ? matsuriRequired : hanabiRequired;
  return required.every(field => event[field] && event[field] !== '');
};

// 数据格式验证
const validateDataFormats = event => {
  return {
    dateFormat: /^\d{4}-\d{2}-\d{2}$/.test(event.date),
    websiteFormat: /^https?:\/\//.test(event.website),
    likesFormat: typeof event.likes === 'number' && event.likes >= 0,
    highlightsFormat:
      Array.isArray(event.highlights) && event.highlights.length > 0,
  };
};
```

## 🌐 多语言系统规范

### 语言使用优先级

**主要语言配置:**

```typescript
// 语言优先级设定
Primary: 中文 (简体)     // 主要用户界面语言
Secondary: 日文          // 原始数据语言，文化准确性
Tertiary: 英文           // 国际化支持，标识符使用

// 内容语言分配
用户界面: 中文
事件名称: 中文主导，日文辅助
技术标识: 英文
SEO元数据: 中文
```

**日文字符使用规范:**

```typescript
// 正确的日文使用模式
const correctJapanese = {
  eventNames: '鎌倉まつり', // 官方正式名称
  descriptions: '鎌倉まつり', // 文化背景说明
  locations: '鶴岡八幡宮', // 地名保持原文
  categories: '山車祭り', // 分类术语
};

// 避免的日文使用
const avoidJapanese = {
  interfaceText: '開始する', // ❌ 界面文字应该用中文
  commonWords: 'すべて', // ❌ 常用词用中文
  technical: 'データベース', // ❌ 技术术语用英文
};
```

### 字符编码与显示

**UTF-8编码标准:**

```typescript
// 文件编码设置
charset: 'UTF-8'
language: 'zh-CN'
font-family: 'Noto Sans CJK SC', 'Microsoft YaHei', sans-serif

// 特殊字符处理
emoji: 使用Unicode标准emoji
japanese: 保持原始日文字符
chinese: 使用简体中文
english: ASCII + 扩展拉丁字符
```

## 🛠️ 操作实施指南

### 页面创建标准流程

**新建matsuri页面步骤:**

```bash
# 1. 创建页面文件
mkdir -p src/app/[region]/matsuri
touch src/app/[region]/matsuri/page.tsx

# 2. 使用标准模板
cp docs/templates/matsuri-template.tsx src/app/[region]/matsuri/page.tsx

# 3. 配置地区信息
# 编辑regionConfig对象

# 4. 添加真实事件数据
# 从omaturilink.com获取数据

# 5. 运行质量检查
npm run check-quality

# 6. 验证结果
# matsuri页面应该显示"缺少花火字段" - 这是正确的
```

**新建hanabi页面步骤:**

```bash
# 1. 创建页面文件
mkdir -p src/app/[region]/hanabi
touch src/app/[region]/hanabi/page.tsx

# 2. 使用标准模板
cp docs/templates/hanabi-template.tsx src/app/[region]/hanabi/page.tsx

# 3. 配置地区信息和花火数据
# 从walkerplus.com获取数据

# 4. 运行质量检查
npm run check-quality

# 5. 验证结果
# hanabi页面应该通过所有数据结构检查
```

### 数据更新操作流程

**定期数据验证:**

```bash
# 每月执行的数据验证
#!/bin/bash

# 1. 检查外部链接有效性
curl -s -o /dev/null -w "%{http_code}" https://omaturilink.com/
curl -s -o /dev/null -w "%{http_code}" https://walkerplus.com/

# 2. 验证数据一致性
npm run check-quality

# 3. 检查编造数据
grep -r "TODO\|FIXME\|estimated\|推测" src/app/

# 4. 验证日期有效性
node scripts/validate-dates.js

# 5. 生成验证报告
npm run generate-validation-report
```

**数据源更新处理:**

```typescript
// 数据更新工作流
const updateDataWorkflow = {
  // 1. 验证新数据来源
  validateSource: url => {
    return fetch(url).then(response => response.ok);
  },

  // 2. 比较数据变化
  compareData: (oldData, newData) => {
    return {
      added: newData.filter(item => !oldData.find(old => old.id === item.id)),
      removed: oldData.filter(item => !newData.find(n => n.id === item.id)),
      modified: newData.filter(item => {
        const old = oldData.find(o => o.id === item.id);
        return old && JSON.stringify(old) !== JSON.stringify(item);
      }),
    };
  },

  // 3. 应用数据更新
  applyUpdates: changes => {
    // 谨慎更新，保持数据真实性
  },
};
```

### SEO优化操作

**元数据优化标准:**

```typescript
// SEO元数据配置模板
export const metadata: Metadata = {
  title: '地区+活动类型+年份+核心关键词 (30-60字符)',
  description: '详细描述包含地区、活动特色、时间信息 (120-160字符)',
  keywords: [
    '主要关键词', // 地区+活动类型
    '次要关键词', // 具体活动名称
    '长尾关键词', // 详细描述性词汇
    '时间关键词', // 2025年、夏季等
    '地理关键词', // 关东、东京等
  ],
  openGraph: {
    title: '与主标题相同或略短',
    description: '与主描述相同或略短',
    type: 'website',
    locale: 'zh_CN',
    url: '规范的URL路径',
    siteName: '关东旅游指南',
    images: [
      {
        url: '/images/活动类型/地区-活动.svg',
        width: 1200,
        height: 630,
        alt: '描述性图片标题',
      },
    ],
  },
  twitter: {
    card: 'summary_large_image',
    title: '适合Twitter的标题',
    description: '适合Twitter的描述',
    images: ['相同的图片路径'],
  },
  alternates: {
    canonical: '/规范的URL路径',
  },
  robots: {
    index: true,
    follow: true,
    googleBot: {
      index: true,
      follow: true,
      'max-video-preview': -1,
      'max-image-preview': 'large',
      'max-snippet': -1,
    },
  },
};
```

## 📋 质量控制检查清单

### 上线前必检项目

**数据真实性确认:**

- [ ] 所有数值数据都有官方来源支撑
- [ ] 没有编造或推测的信息
- [ ] 外部链接都可正常访问
- [ ] 日期信息准确且合理

**技术质量确认:**

- [ ] npm run check-quality 通过率 ≥ 90%
- [ ] 页面结构检查 100% 通过
- [ ] 代码质量检查 0 警告
- [ ] SEO元数据完整且优化

**多语言规范确认:**

- [ ] 中文作为主要用户界面语言
- [ ] 日文仅用于官方名称和文化术语
- [ ] 英文用于技术标识符和国际化
- [ ] 字符编码正确显示

### 持续监控项目

**数据时效性监控:**

```bash
# 定期执行的监控脚本
#!/bin/bash

# 检查过期事件
node scripts/check-outdated-events.js

# 验证外部链接
node scripts/validate-external-links.js

# 监控数据源变化
node scripts/monitor-data-sources.js

# 生成健康状况报告
node scripts/generate-health-report.js
```

**性能监控指标:**

- 页面加载时间 < 2秒
- 首次内容绘制 < 1.5秒
- 累积布局偏移 < 0.1
- 最大内容绘制 < 2.5秒

### 错误处理规程

**数据冲突处理:**

```typescript
// 数据冲突解决优先级
const conflictResolution = {
  // 1. 官方数据 > 第三方数据
  officialSource: 'highest_priority',

  // 2. 最新数据 > 历史数据
  timeStamp: 'newer_preferred',

  // 3. 详细数据 > 简略数据
  completeness: 'more_detailed_preferred',

  // 4. 验证数据 > 未验证数据
  verification: 'verified_only',
};
```

**应急响应流程:**

1. **发现问题** - 立即停止相关功能
2. **评估影响** - 确定问题范围和严重程度
3. **实施修复** - 按照已建立的标准修复
4. **验证修复** - 运行完整质量检查
5. **恢复服务** - 逐步恢复正常功能
6. **事后分析** - 更新文档和预防措施

---

_文档维护: 数据源或验证规则变更时更新_  
_负责团队: 数据管理小组_
