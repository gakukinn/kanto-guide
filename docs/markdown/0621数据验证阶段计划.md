# 0621数据验证阶段计划

## 🎯 阶段目标
验证ISR + 数据库架构的完整可行性，建立小规模数据管理流程，为大规模实施奠定基础。

## 📋 执行计划（预计2-3天完成）

### 第一步：数据库基础验证（0.5天）
**目标**：确认Prisma数据库和API基础功能正常

#### 1.1 验证数据库连接
```bash
# 检查Prisma配置
npx prisma generate
npx prisma db push
npx prisma studio  # 启动管理界面
```

#### 1.2 检查现有数据
- 确认东京花火数据（14个活动）完整性
- 验证数据结构符合接口定义
- 测试数据的增删改查功能

#### 1.3 创建地区基础数据
录入6个地区的基础信息：
- 东京都 (tokyo)
- 埼玉县 (saitama) 
- 千叶县 (chiba)
- 神奈川县 (kanagawa)
- 北关东 (kitakanto)
- 甲信越 (koshinetsu)

### 第二步：示例数据录入（1天）
**目标**：每个地区每种活动类型录入1个高质量示例数据

#### 2.1 数据录入策略
- **总量**：6个地区 × 6种活动 = 36个示例活动
- **数据来源**：优先选择walkerplus已验证的活动
- **质量标准**：必须包含完整的基础信息（日期、地点、描述等）

#### 2.2 活动类型分配
| 地区 | 祭典 | 花见 | 花火 | 红叶 | 灯光 | 文艺 |
|------|------|------|------|------|------|------|
| 东京都 | 三社祭 | 上野公园 | 隅田川花火 | 高尾山 | 东京站灯光 | 歌舞伎座 |
| 埼玉县 | 川越祭 | 大宫公园 | 熊谷花火 | 中津峡 | 埼玉灯光 | 埼玉艺术 |
| 千叶县 | 成田祭 | 泉自然公园 | 市川花火 | 养老渓谷 | 千叶灯光 | 千叶艺术 |
| 神奈川县 | 镰仓祭 | 三溪园 | 横浜花火 | 箱根红叶 | 横浜灯光 | 横浜艺术 |
| 北关东 | 前桥祭 | 赤城山 | 古河花火 | 奥日光 | 栃木灯光 | 群马艺术 |
| 甲信越 | 松本祭 | 高遠城址 | 长冈花火 | 上高地 | 长野灯光 | 新潟艺术 |

#### 2.3 数据录入清单
每个活动必须包含：
- ✅ 基础信息：名称、英文名、日语名
- ✅ 时间信息：年份、月份、具体日期
- ✅ 地点信息：详细地址、交通方式
- ✅ 描述信息：活动描述、特色介绍
- ✅ 联系信息：官方网站、电话（如有）
- ✅ 验证信息：数据来源、验证状态

### 第三步：API接口创建（0.5天）
**目标**：为所有活动类型创建API接口

#### 3.1 API接口清单
创建以下API端点：
- `/api/matsuri/[region]` - 祭典活动
- `/api/hanami/[region]` - 花见活动  
- `/api/hanabi/[region]` - 花火活动（东京已有）
- `/api/momiji/[region]` - 红叶活动
- `/api/illumination/[region]` - 灯光活动
- `/api/culture/[region]` - 文艺活动

#### 3.2 API功能要求
- 支持按地区筛选
- 支持按月份筛选
- 返回标准化JSON格式
- 包含分页和排序功能

### 第四步：页面连接验证（1天）
**目标**：验证所有36个三层页面能正确从数据库获取数据

#### 4.1 页面修改清单
修改以下页面使用数据库数据：
- `app/[region]/matsuri/page.tsx` - 6个祭典列表页
- `app/[region]/hanami/page.tsx` - 6个花见列表页
- `app/[region]/hanabi/page.tsx` - 5个花火列表页（东京已完成）
- `app/[region]/momiji/page.tsx` - 6个红叶列表页
- `app/[region]/illumination/page.tsx` - 6个灯光列表页
- `app/[region]/culture/page.tsx` - 6个文艺列表页

#### 4.2 页面功能验证
每个页面需要验证：
- ✅ 数据正确获取和显示
- ✅ 筛选和排序功能正常
- ✅ 详情链接正确跳转
- ✅ 页面加载速度合理
- ✅ 响应式设计正常

### 第五步：ISR功能测试（0.5天）
**目标**：验证数据更新后页面自动重新生成

#### 5.1 ISR配置验证
- 检查页面revalidate设置
- 测试数据更新触发机制
- 验证缓存失效和重新生成

#### 5.2 功能测试流程
1. 在Prisma Studio中修改一个活动数据
2. 访问对应的列表页面，确认数据已更新
3. 检查页面重新生成时间
4. 验证相关页面是否同步更新

## 📊 成功验收标准

### 技术指标
- [ ] 36个API接口全部正常工作
- [ ] 36个列表页面正确显示数据库数据
- [ ] ISR功能正常，数据更新后页面自动重新生成
- [ ] 页面加载速度 < 2秒
- [ ] 移动端显示正常

### 数据质量指标
- [ ] 36个示例活动数据完整准确
- [ ] 所有活动都有官方来源验证
- [ ] 数据格式统一，符合接口定义
- [ ] 地区和活动类型分布均匀

### 用户体验指标
- [ ] 页面导航流畅，无错误链接
- [ ] 数据展示清晰，信息完整
- [ ] 筛选和搜索功能正常
- [ ] 响应式设计在各设备正常显示

## 🚀 执行时间表

### Day 1：数据库和基础数据
- 上午：验证数据库连接，检查现有数据
- 下午：录入6个地区基础信息，开始示例数据录入

### Day 2：数据录入和API创建  
- 上午：完成36个示例活动数据录入
- 下午：创建API接口，测试数据获取

### Day 3：页面连接和功能验证
- 上午：修改页面连接数据库，测试显示效果
- 下午：ISR功能测试，整体验收

## 📝 风险控制

### 技术风险
- **数据库连接问题**：提前备份现有数据
- **API接口错误**：逐个测试，确保格式正确
- **页面显示异常**：保留原有静态数据作为备份

### 数据风险
- **数据质量问题**：建立数据验证规则
- **数据丢失风险**：每天备份数据库文件
- **格式不统一**：建立数据录入模板

### 时间风险
- **进度延迟**：每天检查进度，及时调整
- **功能复杂**：优先保证核心功能，次要功能可延后
- **测试不足**：预留充分测试时间

## 📈 后续计划预览

完成本阶段后，下一步将是：
1. **大规模数据录入**：每个活动类型录入10-20个真实活动
2. **四层详情页面生成**：根据数据库自动生成详情页面
3. **数据管理系统完善**：优化Prisma Studio界面，建立日常运营流程
4. **代码质量优化**：修复TypeScript错误，提升项目健康度

---

## 💡 关键成功因素

1. **数据质量第一**：宁可数量少，也要保证质量高
2. **逐步验证**：每个步骤都要充分测试再进行下一步
3. **保持备份**：重要操作前都要备份数据和代码
4. **记录问题**：遇到问题及时记录，便于后续优化

**项目成功的关键在于建立可靠的数据管理流程，而不是一次性完成所有功能。** 