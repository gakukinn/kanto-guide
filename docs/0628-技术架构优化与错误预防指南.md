
**ç‰ˆæœ¬**: v1.0  
**é€‚ç”¨èŒƒå›´**: JapanGuideé¡¹ç›®æ‰€æœ‰é¡µé¢ç”Ÿæˆå™¨

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

### 1. é™æ€é¡µé¢ä¸æ•°æ®åº“åˆ†ç¦»åŸåˆ™
```
âœ… é™æ€é¡µé¢ï¼šä½¿ç”¨JSONæ–‡ä»¶å­˜å‚¨ï¼Œä¸ä¾èµ–Prismaæ•°æ®åº“
âŒ åŠ¨æ€é¡µé¢ï¼šå¯ä»¥ä½¿ç”¨æ•°æ®åº“ï¼Œä½†éœ€æ˜ç¡®åŒºåˆ†
```

**å…³é”®è®°å¿†ç‚¹**ï¼š
- å››å±‚é¡µé¢ï¼ˆè¯¦æƒ…é¡µé¢ï¼‰= é™æ€é¡µé¢ = åªç”¨JSONæ–‡ä»¶
- ç®¡ç†åå° = åŠ¨æ€é¡µé¢ = å¯ä»¥ç”¨æ•°æ®åº“
- ç»ä¸åœ¨é™æ€é¡µé¢é€»è¾‘ä¸­å¼•å…¥æ•°æ®åº“ä¾èµ–

### 2. ç»Ÿä¸€è·¯å¾„å‘½åè§„åˆ™
```
æ ‡å‡†æ ¼å¼: /{region}/{activityType}/{detailPageFolder}
ç¤ºä¾‹: /tokyo/hanabi/activity-2025-summer-festival-abc123
```

**ç»„æˆéƒ¨åˆ†**ï¼š
- `region`: åœ°åŒºä»£ç ï¼ˆtokyo, kanagawaç­‰ï¼‰
- `activityType`: æ´»åŠ¨ç±»å‹ï¼ˆhanabi, matsuriç­‰ï¼‰
- `detailPageFolder`: æ™ºèƒ½ç”Ÿæˆçš„æ–‡ä»¶å¤¹åï¼ˆactivity-å¹´ä»½-å…³é”®è¯-éšæœºIDï¼‰

### 3. JSONæ–‡ä»¶æ ‡å‡†ç»“æ„
```
å•ä¸ªæ´»åŠ¨: data/activities/{id}.json
åœ°åŒºæ±‡æ€»: data/regions/{region}/{activityType}.json
```

## ğŸ”§ æŠ€æœ¯å®ç°æ ‡å‡†

### A. é¡µé¢ç”Ÿæˆå™¨APIç»“æ„
```javascript
// æ ‡å‡†POSTè¯·æ±‚å‚æ•°
{
  data: Object,           // æ´»åŠ¨æ•°æ®
  activityType: string,   // æ´»åŠ¨ç±»å‹
  region: string,         // åœ°åŒº
  images: Array,          // å›¾ç‰‡æ•°ç»„
  duplicateAction: string,// é‡å¤å¤„ç†åŠ¨ä½œ
  overwriteTarget: string,// è¦†ç›–ç›®æ ‡ID
  forceOverwrite: boolean // å¼ºåˆ¶è¦†ç›–æ ‡å¿—
}

// æ ‡å‡†å“åº”æ ¼å¼
{
  success: boolean,
  message: string,
  pageUrl?: string,
  conflictData?: Object  // å†²çªæ—¶è¿”å›
}
```

### B. æ™ºèƒ½é‡å¤æ£€æµ‹ç®—æ³•
```javascript
// ç›¸ä¼¼åº¦åˆ¤æ–­æ¡ä»¶
const isDuplicate = 
  nameSimilarity >= 85 ||
  (nameSimilarity >= 75 && (areDatesSimilar || areAddressesSimilar)) ||
  (nameSimilarity >= 30 && areDatesSimilar && areAddressesSimilar);

// è®¡ç®—å‡½æ•°
function calculateSimilarity(str1, str2) {
  // ä½¿ç”¨Levenshteinè·ç¦»ç®—æ³•
  const distance = levenshteinDistance(str1, str2);
  const maxLength = Math.max(str1.length, str2.length);
  return ((maxLength - distance) / maxLength) * 100;
}
```

### C. è¦†ç›–åŠŸèƒ½å®ç°æ ‡å‡†
```javascript
// IDç®¡ç†é€»è¾‘
let staticId: string;
if (duplicateCheck.isDuplicate && forceOverwrite && overwriteTarget) {
  staticId = overwriteTarget; // é‡ç”¨ç°æœ‰ID
} else {
  staticId = Date.now().toString(); // ç”Ÿæˆæ–°ID
}

// è¦†ç›–æ“ä½œé¡ºåº
1. æ£€æµ‹é‡å¤ â†’ 2. ç”¨æˆ·ç¡®è®¤ â†’ 3. é‡ç”¨ID â†’ 4. è¦†ç›–æ–‡ä»¶
```

## ğŸš¨ å¸¸è§é”™è¯¯æ¨¡å¼ä¸é¢„é˜²

### é”™è¯¯ç±»å‹1ï¼šæ•°æ®åº“ä¾èµ–æ··æ·†
**é”™è¯¯ç¤ºä¾‹**ï¼š
```javascript
// âŒ é”™è¯¯ï¼šåœ¨é™æ€é¡µé¢é€»è¾‘ä¸­ä½¿ç”¨Prisma
const dbRecord = await prisma.hanabiEvent.findFirst({...});
```

**æ­£ç¡®åšæ³•**ï¼š
```javascript
// âœ… æ­£ç¡®ï¼šé™æ€é¡µé¢åªä½¿ç”¨JSONæ–‡ä»¶
const jsonData = JSON.parse(await fs.readFile(`data/activities/${id}.json`, 'utf8'));
```

**é¢„é˜²æªæ–½**ï¼š
- åœ¨æ–‡ä»¶å¤´éƒ¨æ·»åŠ æ³¨é‡Šæ ‡æ˜é¡µé¢ç±»å‹
- ä»£ç å®¡æŸ¥æ—¶é‡ç‚¹æ£€æŸ¥æ•°æ®æº
- å»ºç«‹æ˜ç¡®çš„æ–‡ä»¶å‘½åçº¦å®š

### é”™è¯¯ç±»å‹2ï¼šå­—æ®µæ˜ å°„é¡ºåºé”™è¯¯
**é”™è¯¯ç¤ºä¾‹**ï¼š
```javascript
// âŒ é”™è¯¯ï¼šä¼˜å…ˆçº§é¡ºåºä¸å½“
description: data.eventName || data.name || data.description
```

**æ­£ç¡®åšæ³•**ï¼š
```javascript
// âœ… æ­£ç¡®ï¼šä¼˜å…ˆä½¿ç”¨å¤„ç†åçš„æ ‡å‡†å­—æ®µ
description: data.description || data.parsedDescription || data.name || data.eventName || ''
```

**é¢„é˜²æªæ–½**ï¼š
- å»ºç«‹å­—æ®µä¼˜å…ˆçº§æ–‡æ¡£
- ä½¿ç”¨TypeScriptæ¥å£å¼ºåˆ¶ç±»å‹æ£€æŸ¥
- æ·»åŠ æ•°æ®éªŒè¯å‡½æ•°

### é”™è¯¯ç±»å‹3ï¼šè¦†ç›–åŠŸèƒ½IDå†²çª
**é”™è¯¯ç¤ºä¾‹**ï¼š
```javascript
// âŒ é”™è¯¯ï¼šè¦†ç›–æ—¶ä»ç”Ÿæˆæ–°ID
const newId = Date.now().toString();
```

**æ­£ç¡®åšæ³•**ï¼š
```javascript
// âœ… æ­£ç¡®ï¼šè¦†ç›–æ—¶é‡ç”¨ç°æœ‰ID
const staticId = (isOverwrite && targetId) ? targetId : Date.now().toString();
```

**é¢„é˜²æªæ–½**ï¼š
- æ˜ç¡®åŒºåˆ†æ–°å»ºå’Œè¦†ç›–æ¨¡å¼
- æ·»åŠ IDé‡ç”¨é€»è¾‘éªŒè¯
- è®°å½•è¯¦ç»†çš„æ“ä½œæ—¥å¿—

### é”™è¯¯ç±»å‹4ï¼šTypeScriptä½œç”¨åŸŸé—®é¢˜
**é”™è¯¯ç¤ºä¾‹**ï¼š
```javascript
// âŒ é”™è¯¯ï¼šconstå˜é‡é‡æ–°èµ‹å€¼
const overwriteTarget = providedTarget;
if (condition) {
  overwriteTarget = newTarget; // TypeError
}
```

**æ­£ç¡®åšæ³•**ï¼š
```javascript
// âœ… æ­£ç¡®ï¼šåˆç†çš„å˜é‡å£°æ˜
let overwriteTarget = providedTarget;
if (condition) {
  overwriteTarget = newTarget; // OK
}
```

**é¢„é˜²æªæ–½**ï¼š
- æ˜ç¡®å˜é‡çš„å¯å˜æ€§éœ€æ±‚
- ä½¿ç”¨let/constçš„æœ€ä½³å®è·µ
- è®¾è®¡åˆç†çš„å˜é‡ä½œç”¨åŸŸ

## ğŸ“‹ å¼€å‘æ£€æŸ¥æ¸…å•

### é¡µé¢ç”Ÿæˆå™¨å¼€å‘æ¸…å•
- [ ] ç¡®è®¤é¡µé¢ç±»å‹ï¼ˆé™æ€/åŠ¨æ€ï¼‰
- [ ] æ£€æŸ¥æ•°æ®æºç±»å‹ï¼ˆJSON/æ•°æ®åº“ï¼‰
- [ ] éªŒè¯è·¯å¾„å‘½åè§„åˆ™
- [ ] å®ç°æ™ºèƒ½é‡å¤æ£€æµ‹
- [ ] æ·»åŠ è¦†ç›–åŠŸèƒ½æ”¯æŒ
- [ ] é…ç½®å›¾ç‰‡æœç´¢åŠŸèƒ½
- [ ] æµ‹è¯•æ‰€æœ‰é”™è¯¯åœºæ™¯
- [ ] æ·»åŠ è¯¦ç»†æ—¥å¿—è®°å½•

### æ¨¡æ¿ç»„ä»¶å¼€å‘æ¸…å•
- [ ] æ·»åŠ "use client"æŒ‡ä»¤ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] å®šä¹‰æ¸…æ™°çš„TypeScriptæ¥å£
- [ ] å®ç°å“åº”å¼å¸ƒå±€
- [ ] ä¿æŒæ ·å¼ä¸€è‡´æ€§
- [ ] æ”¯æŒå¿…è¦çš„å­—æ®µç±»å‹
- [ ] æ·»åŠ é”™è¯¯è¾¹ç•Œå¤„ç†
- [ ] æµ‹è¯•å„ç§æ•°æ®æ ¼å¼

### æ•°æ®å¤„ç†å¼€å‘æ¸…å•
- [ ] éªŒè¯è¾“å…¥æ•°æ®æ ¼å¼
- [ ] å®ç°å­—æ®µæ˜ å°„é€»è¾‘
- [ ] æ·»åŠ æ•°æ®æ¸…æ´—åŠŸèƒ½
- [ ] æ”¯æŒå¤šè¯­è¨€å†…å®¹
- [ ] å¤„ç†ç¼ºå¤±å­—æ®µæƒ…å†µ
- [ ] è®°å½•æ•°æ®è½¬æ¢æ—¥å¿—

## ğŸ”„ æŒç»­æ”¹è¿›æœºåˆ¶

### 1. é”™è¯¯ç›‘æ§ä½“ç³»
```javascript
// é”™è¯¯æ•è·å’Œè®°å½•
try {
  // ä¸šåŠ¡é€»è¾‘
} catch (error) {
  console.error(`ğŸš¨ ${functionName} é”™è¯¯:`, error);
  // è®°å½•åˆ°é”™è¯¯æ—¥å¿—
  await logError(error, context);
  throw error;
}
```

### 2. æ€§èƒ½ç›‘æ§æŒ‡æ ‡
- é¡µé¢ç”Ÿæˆæ—¶é—´ï¼š< 500ms
- å›¾ç‰‡æœç´¢å“åº”ï¼š< 1000ms
- é‡å¤æ£€æµ‹æ—¶é—´ï¼š< 100ms
- JSONæ–‡ä»¶å†™å…¥ï¼š< 50ms

### 3. ä»£ç è´¨é‡ä¿è¯
```json
// package.json scripts
{
  "lint": "eslint . --ext .ts,.tsx",
  "type-check": "tsc --noEmit",
  "test": "jest",
  "validate-all": "npm run lint && npm run type-check && npm run test"
}
```

### 4. æ–‡æ¡£ç»´æŠ¤æ ‡å‡†
- æ¯æ¬¡é‡å¤§ä¿®æ”¹åæ›´æ–°æŠ€æœ¯æ–‡æ¡£
- è®°å½•æ‰€æœ‰é”™è¯¯æ¨¡å¼å’Œè§£å†³æ–¹æ¡ˆ
- ç»´æŠ¤APIæ¥å£å˜æ›´æ—¥å¿—
- æ›´æ–°å¼€å‘è€…æŒ‡å—å’Œæœ€ä½³å®è·µ

## ğŸ“Š æŠ€æœ¯å€ºåŠ¡ç®¡ç†

### å·²çŸ¥æŠ€æœ¯å€ºåŠ¡
1. **å›¾ç‰‡æœç´¢ç¼“å­˜**: å½“å‰æ¯æ¬¡éƒ½é‡æ–°æœç´¢ï¼Œå¯ä»¥æ·»åŠ ç¼“å­˜æœºåˆ¶
2. **é”™è¯¯å¤„ç†**: éƒ¨åˆ†APIç¼ºå°‘è¯¦ç»†çš„é”™è¯¯åˆ†ç±»å’Œç”¨æˆ·å‹å¥½æç¤º
3. **æµ‹è¯•è¦†ç›–**: ç¼ºå°‘è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œç‰¹åˆ«æ˜¯è¦†ç›–åŠŸèƒ½çš„æµ‹è¯•
4. **æ€§èƒ½ä¼˜åŒ–**: å¤§é‡JSONæ–‡ä»¶è¯»å†™å¯ä»¥è€ƒè™‘æ‰¹é‡å¤„ç†

### ä¼˜å…ˆçº§æ’åº
1. **é«˜ä¼˜å…ˆçº§**: æ·»åŠ è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œç¡®ä¿åŠŸèƒ½ç¨³å®šæ€§
2. **ä¸­ä¼˜å…ˆçº§**: å®ç°å›¾ç‰‡æœç´¢ç¼“å­˜ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
3. **ä½ä¼˜å…ˆçº§**: ä¼˜åŒ–JSONæ–‡ä»¶å¤„ç†æ€§èƒ½

## ğŸ“ å›¢é˜ŸçŸ¥è¯†ä¼ æ‰¿

### æ–°AIåä½œè€…å¿«é€Ÿä¸Šæ‰‹æŒ‡å—
1. **ç¬¬ä¸€æ­¥**: é˜…è¯»æœ¬æ–‡æ¡£å’Œé¡¹ç›®èƒŒæ™¯
2. **ç¬¬äºŒæ­¥**: ç†è§£é™æ€é¡µé¢ä¸æ•°æ®åº“åˆ†ç¦»åŸåˆ™
3. **ç¬¬ä¸‰æ­¥**: ç†Ÿæ‚‰ç»Ÿä¸€çš„è·¯å¾„å‘½åè§„åˆ™
4. **ç¬¬å››æ­¥**: æŒæ¡æ™ºèƒ½é‡å¤æ£€æµ‹é€»è¾‘
5. **ç¬¬äº”æ­¥**: äº†è§£è¦†ç›–åŠŸèƒ½å®ç°æœºåˆ¶

### å…³é”®æ¦‚å¿µè®°å¿†å¡ç‰‡
```
å¡ç‰‡1: å››å±‚é¡µé¢ = é™æ€é¡µé¢ = åªç”¨JSONæ–‡ä»¶
å¡ç‰‡2: è·¯å¾„æ ¼å¼ = /{region}/{activityType}/{detailPageFolder}
å¡ç‰‡3: è¦†ç›–é€»è¾‘ = æ£€æµ‹â†’ç¡®è®¤â†’é‡ç”¨IDâ†’è¦†ç›–æ–‡ä»¶
å¡ç‰‡4: å­—æ®µä¼˜å…ˆçº§ = å¤„ç†åå­—æ®µ > åŸå§‹å­—æ®µ > é»˜è®¤å€¼
```

---

**ç»“è¯­**: è¿™ä»½æŒ‡å—æ±‡æ€»äº†é¡¹ç›®å¼€å‘ä¸­çš„æ ¸å¿ƒæŠ€æœ¯åŸåˆ™å’Œé”™è¯¯é¢„é˜²æªæ–½ã€‚éµå¾ªè¿™äº›æ ‡å‡†å¯ä»¥é¿å…å¸¸è§é”™è¯¯ï¼Œæé«˜å¼€å‘æ•ˆç‡ï¼Œç¡®ä¿é¡¹ç›®è´¨é‡ã€‚å»ºè®®æ‰€æœ‰åä½œè€…åœ¨å¼€å‘å‰ä»”ç»†é˜…è¯»å¹¶ä¸¥æ ¼æ‰§è¡Œã€‚ 