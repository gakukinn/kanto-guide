# Kanto Travel Guide 故障排除与最佳实践

_文档更新时间: 2025-06-15_  
_文档类型: 故障排除 | 错误预防_

## 🚨 紧急故障排除清单

### 质量检查器误报问题

**问题症状:**

```bash
❌ 花火大会数据结构: 缺少必要字段: visitors 或 expectedVisitors; 缺少必要字段: fireworks 或 fireworksCount
❌ WalkerPlus数据源标注: 缺少WalkerPlus数据源标注
```

**快速诊断:**

1. 检查页面类型：是matsuri还是hanabi？
2. matsuri页面报告"缺少花火字段" = ✅ 正确行为
3. hanabi页面报告"缺少花火字段" = ❌ 真正的错误

**解决方案:**

```typescript
// matsuri页面应该使用的数据结构 (正确)
const matsuriEvent = {
  highlights: ['🎌 山车巡游', '🎭 传统艺能'],
  category: '祭典类别',
  region: 'saitama',
  // 不应该有: fireworks, fireworksCount, expectedVisitors
};

// hanabi页面应该使用的数据结构 (正确)
const hanabiEvent = {
  fireworks: '约2万发',
  expectedVisitors: '50万人',
  dataSource: 'WalkerPlus',
  highlights: ['🎆 特大号花火', '🌟 连发表演'],
};
```

### 数据编造违规检测

**问题症状:**
为了完成数据结构而创建虚假数据

**危险信号:**

```typescript
// ❌ 严重违规示例
expectedVisitors: '480000',        // 无法验证的数字
fireworks: '无（传统祭典）',        // 错误的字段分类
dataSource: 'estimated',          // 模糊的数据来源
likes: 0,                         // 明显的占位符数值
```

**立即修复:**

```typescript
// ✅ 正确的数据使用
likes: 412,                       // 来自omaturilink.com真实数据
website: 'https://official.jp',   // 可验证的官方链接
description: '官方活动描述',       // 来自官方的真实描述
// 如果没有数据，宁可不填也不要编造
```

### 页面模板混淆问题

**问题症状:**
页面使用错误的模板或数据结构

**快速检查:**

```bash
# 检查页面路径确定类型
/[region]/matsuri/page.tsx → 应该使用 MatsuriPageTemplate
/[region]/hanabi/page.tsx  → 应该使用 HanabiPageTemplate

# 检查数据来源
matsuri → omaturilink.com
hanabi  → walkerplus.com
```

**修复步骤:**

1. 确认页面类型和预期模板
2. 检查导入的模板组件
3. 验证数据结构匹配模板要求
4. 确认数据来源正确

## 🔍 常见错误模式与解决方案

### 错误1: 动态加载组件过度复杂

**错误模式:**

```typescript
// ❌ 过度复杂的动态组件
export default function ComplexPage() {
  const [events, setEvents] = useState<Event[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const fetchEvents = async () => {
      try {
        const response = await fetch('/api/events');
        // 大量错误处理和状态管理...
      } catch (err) {
        setError('Failed to load');
      } finally {
        setLoading(false);
      }
    };
    fetchEvents();
  }, []);

  if (loading) return <LoadingSpinner />;
  if (error) return <ErrorDisplay />;
  // 更多复杂逻辑...
}
```

**修复方案:**

```typescript
// ✅ 简洁的静态组件
'use client';
import MatsuriPageTemplate from '@/components/MatsuriPageTemplate';
import { Metadata } from 'next';

export const metadata: Metadata = { /* SEO配置 */ };

const regionConfig = { /* 配置 */ };
const eventsData = [ /* 静态数据 */ ];

export default function RegionMatsuri() {
  return (
    <MatsuriPageTemplate
      region={regionConfig}
      events={eventsData}
      pageTitle="标题"
      pageDescription="描述"
      regionKey="region"
      activityKey="matsuri"
    />
  );
}
```

### 错误2: 数据结构不一致

**错误模式:**

```typescript
// ❌ 不一致的数据字段
const inconsistentEvents = [
  {
    title: '事件1',
    name: '事件1', // 重复字段
    date: '2025-07-15',
    time: '19:00', // 应该合并到dates
    location: '东京',
    venue: '会场', // 字段名称不统一
  },
  {
    title: '事件2',
    eventName: '事件2', // 字段名称不一致
    eventDate: '2025-08-20', // 字段名称不一致
    place: '神奈川', // 字段名称不一致
  },
];
```

**修复方案:**

```typescript
// ✅ 统一的数据结构
const consistentEvents = [
  {
    id: 'event-1',
    title: '事件1',
    name: '事件1显示名称',
    date: '2025-07-15',
    dates: '2025年7月15日 19:00',
    location: '东京都',
    venue: '具体会场名称',
    highlights: ['🎌 特色1', '🎭 特色2'],
    likes: 412,
    website: 'https://official.com',
    description: '详细描述',
    category: '分类',
    prefecture: '东京都',
    region: 'tokyo',
  },
];
```

### 错误3: 并发工具调用使用不当

**错误模式:**

```javascript
// ❌ 低效的串行调用
const file1 = await read_file('file1.tsx');
// 等待...
const file2 = await read_file('file2.tsx');
// 等待...
const search1 = await grep_search('pattern1');
// 等待...
const search2 = await codebase_search('query');
```

**修复方案:**

```javascript
// ✅ 高效的并行调用
<function_calls>
  <invoke name="read_file">file1.tsx</invoke>
  <invoke name="read_file">file2.tsx</invoke>
  <invoke name="grep_search">pattern1</invoke>
  <invoke name="codebase_search">query</invoke>
</function_calls>
// 3-5x速度提升！
```

## 🛠️ 调试工具与技巧

### 质量检查工具使用

**基本检查命令:**

```bash
# 运行完整质量检查
npm run check-quality

# 检查特定问题
grep -r "expectedVisitors" src/        # 查找编造数据
grep -r "console.log" src/             # 查找调试代码
grep -r "TODO\|FIXME" src/             # 查找未完成任务
```

**结果解读技巧:**

```bash
# 理解质量检查器输出
✅ = 真正的成功
❌ = 可能是错误，也可能是预期行为（如matsuri缺少花火字段）
⚠️ = 建议改进，非必需修复

# 重点关注的错误类型
严重错误 (❌): 立即修复
警告 (⚠️): 优化建议
信息 (ℹ️): 参考信息
```

### 代码搜索最佳实践

**搜索策略组合:**

```javascript
// 1. 语义搜索 - 理解功能
codebase_search('matsuri page template configuration');

// 2. 精确搜索 - 查找问题
grep_search('expectedVisitors|fireworks|dataSource');

// 3. 文件定位 - 快速找到
file_search('matsuri.*page|matsuri.*template');

// 4. 深入分析 - 详细检查
read_file('src/app/tokyo/matsuri/page.tsx');
```

**并行搜索模式:**

```javascript
// 全面信息收集
<function_calls>
  <invoke name="codebase_search">matsuri data structure</invoke>
  <invoke name="grep_search">fireworks.*matsuri</invoke>
  <invoke name="file_search">MatsuriPageTemplate</invoke>
  <invoke name="grep_search">expectedVisitors</invoke>
</function_calls>
```

## 📋 预防性检查清单

### 开发前必做检查

**项目状态确认:**

```bash
# 1. 检查当前质量状况
npm run check-quality

# 2. 查看最新文档
ls docs/0615*

# 3. 了解项目结构
find src/app -name "page.tsx" | head -10
```

**技术债务识别:**

- [ ] 查看质量检查器报告中的严重错误
- [ ] 识别编造数据模式
- [ ] 检查API vs 静态数据一致性
- [ ] 验证模板使用正确性

### 开发中持续检查

**代码修改后验证:**

```bash
# 每次修改后运行
npm run check-quality

# 重点检查变化
git diff --name-only | xargs grep -l "expectedVisitors\|fireworks"
```

**数据完整性验证:**

- [ ] 所有数据必须有可验证来源
- [ ] 绝不编造任何数值数据
- [ ] 保持商业网站的信誉标准
- [ ] 数据字段命名一致性

### 提交前最终检查

**质量标准确认:**

- [ ] 页面结构检查100%通过
- [ ] 代码质量0警告
- [ ] 数据真实性100%保证
- [ ] SEO元数据完整

**性能验证:**

- [ ] 静态数据优于动态API
- [ ] 组件复杂度合理
- [ ] 加载速度符合要求

## 🎯 最佳实践指南

### 数据管理最佳实践

**零编造政策执行:**

```typescript
// ✅ 数据管理原则
1. 只使用官方来源数据
2. 每个数据点都可追溯
3. 宁可不完整，也要保持真实
4. 定期验证数据来源有效性

// ✅ 数据验证检查
const isValidData = (data) => {
  return data.website.startsWith('https://') &&
         data.likes > 0 &&
         data.description.length > 10 &&
         !data.description.includes('TODO');
};
```

### 开发效率最佳实践

**并行工作流程:**

```javascript
// ✅ 高效开发模式
1. 规划需要的信息
2. 一次性并行收集所有数据
3. 批量分析结果
4. 并行执行修改操作
5. 统一验证结果

// ✅ 工具使用优先级
并行 > 串行
静态 > 动态
简单 > 复杂
验证 > 假设
```

### 错误预防策略

**建立检查习惯:**

1. **修改前**: 理解现有结构和要求
2. **修改中**: 遵循已建立的模式和规范
3. **修改后**: 运行质量检查验证结果
4. **提交前**: 最终全面验证

**关键原则记忆:**

- 商业网站数据真实性不可妥协
- matsuri ≠ hanabi，模板和验证都不同
- 质量检查器"错误"可能是正确行为
- 并行工具调用显著提升效率

---

_文档维护: 发现新问题时及时更新_  
_紧急联系: 查看项目README获取支持信息_
