# 0628-Next.js项目中文翻译实施指南

## 📋 文档目的
基于项目真实架构，提供准确的中文翻译实施步骤，优先解决中文用户体验问题。

## 🔍 项目真实现状分析（已重新验证）

### 真实项目架构
- **技术栈**：Next.js 15.3.3 + TypeScript + TailwindCSS
- **数据源**：111个活动JSON文件（`data/activities/` 目录，已确认）
- **页面结构**：混合路由（`app/[locale]` + `app/tokyo|saitama|chiba|kanagawa|kitakanto|koshinetsu`）
- **构建方式**：目前未启用静态导出（`output: 'export'` 被注释）
- **数据库**：Prisma完整配置但未在实际代码中使用

### 地区配置（基于regionConfig.ts）
6个地区：东京都、神奈川县、千叶县、埼玉县、北关东、甲信越

### 现有翻译状态
✅ **已存在但不完整**：
- `src/lib/i18n.ts` 基础配置
- 简单的翻译加载函数

❌ **关键缺失**：
- 没有使用专业的国际化库
- 中文翻译文件不完整
- 组件中无翻译实现

## 🚨 重要发现：当前翻译状态
项目有翻译的**基础结构**但**没有实际中文翻译功能**。

## 🔧 推荐技术方案

### 方案选择：next-intl (最佳实践)

采用 **next-intl 专业国际化方案**：
- ✅ 专为Next.js App Router设计
- ✅ 功能强大：支持复数、参数插值、双语显示
- ✅ 类型安全：完整TypeScript支持
- ✅ 性能优秀：服务端渲染优化
- ✅ 社区活跃：GitHub 2.3k+ stars
- ✅ 快速实施，立即见效
- ✅ 完全兼容现有架构

## 📝 详细实施步骤（next-intl 4.3.1）

### 第一步：安装next-intl

#### 1.1 安装依赖
```bash
npm install next-intl
```

#### 1.2 创建正确的文件结构
```bash
mkdir -p messages
mkdir -p src/i18n
```

### 第二步：创建路由配置

#### 2.1 创建 src/i18n/routing.ts
```typescript
import {defineRouting} from 'next-intl/routing';
 
export const routing = defineRouting({
  // 支持的语言列表
  locales: ['zh'],
 
  // 默认语言
  defaultLocale: 'zh',
  
  // 不使用语言前缀 (因为项目只有中文)
  localePrefix: 'never'
});
```

#### 2.2 创建 src/i18n/navigation.ts
```typescript
import {createNavigation} from 'next-intl/navigation';
import {routing} from './routing';
 
// 基于路由配置的导航API包装器
export const {Link, redirect, usePathname, useRouter, getPathname} =
  createNavigation(routing);
```

#### 2.3 创建 src/i18n/request.ts
```typescript
import {getRequestConfig} from 'next-intl/server';
import {hasLocale} from 'next-intl';
import {routing} from './routing';
 
export default getRequestConfig(async ({requestLocale}) => {
  // 通常对应 [locale] 段
  const requested = await requestLocale;
  const locale = hasLocale(routing.locales, requested)
    ? requested
    : routing.defaultLocale;
 
  return {
    locale,
    messages: (await import(`../../messages/${locale}.json`)).default
  };
});
```

### 第三步：创建中间件

#### 3.1 创建 middleware.ts (根目录)
```typescript
import createMiddleware from 'next-intl/middleware';
import {routing} from './src/i18n/routing';
 
export default createMiddleware(routing);
 
export const config = {
  // 匹配所有路径除了api、_next等
  matcher: ['/((?!api|_next|_vercel|.*\\..*).*)']
};
```

### 第四步：更新Next.js配置

#### 4.1 更新 next.config.js
```javascript
const createNextIntlPlugin = require('next-intl/plugin');
 
const withNextIntl = createNextIntlPlugin(
  // 指定i18n配置文件路径
  './src/i18n/request.ts'
);

/** @type {import('next').NextConfig} */
const nextConfig = {
  // output: 'export', // 暂时注释，完成翻译后再启用
  // trailingSlash: true, // 暂时注释
  images: {
    unoptimized: true,
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'images.unsplash.com',
      },
      {
        protocol: 'https',
        hostname: 'res.cloudinary.com',
      },
      {
        protocol: 'https',
        hostname: 'i.ytimg.com',
      },
    ],
  },
  // 保留现有的其他配置...
};

module.exports = withNextIntl(nextConfig);
```

### 第五步：创建翻译文件

#### 5.1 创建 messages/zh.json
```json
{
  "navigation": {
    "home": "首页",
    "activities": "活动"
  },
  "regions": {
    "tokyo": "东京都",
    "saitama": "埼玉县",
    "chiba": "千叶县", 
    "kanagawa": "神奈川县",
    "kitakanto": "北关东",
    "koshinetsu": "甲信越"
  },
  "activities": {
    "hanabi": "花火大会",
    "matsuri": "夏日祭典",
    "hanami": "花见会",
    "culture": "文化艺术",
    "momiji": "红叶狩",
    "illumination": "灯光秀"
  },
  "hanabi": {
    "fireworksCount": "烟花数量",
    "fireworksTime": "燃放时间",
    "expectedVisitors": "预计观众",
    "date": "举办日期",
    "time": "举办时间",
    "weatherInfo": "雨天安排",
    "price": "门票信息",
    "foodStalls": "小吃摊位",
    "notes": "其他说明",
    "venue": "举办地点",
    "access": "交通方式",
    "parking": "停车场",
    "contact": "联系方式",
    "highlights": "精彩看点",
    "basicInfo": "花火大会信息",
    "venueInfo": "会场・联系信息",
    "activityIntro": "活动简介",
    "locationMap": "位置地图"
  },
  "common": {
    "seeOfficial": "详见官网",
    "pleaseCheckOfficial": "请以官方信息为准",
    "noImage": "暂无图片"
  }
}
```

### 第六步：修改模板使用翻译

#### 6.1 修改 WalkerPlusHanabiTemplate.tsx（测试）
```typescript
// 在文件顶部添加导入
import {useTranslations} from 'next-intl';

export default function WalkerPlusHanabiTemplate({
  data,
  regionKey,
  activityKey,
  regionConfig,
  activityConfig,
}: WalkerPlusHanabiTemplateProps) {
  // 添加翻译hook
  const t = useTranslations('hanabi');
  const tCommon = useTranslations('common');
  
  // 现有代码...
  
  // 修改标签文本，例如：
  // 原来：见どころ
  // 改为：{t('highlights')}
  
  // 原来：🎇 打ち上げ数：
  // 改为：🎇 {t('fireworksCount')}：
}
```

### 第七步：测试验证

#### 7.1 启动开发服务器测试
```bash
npm run dev
```

#### 7.2 访问测试页面
```
http://localhost:3000/tokyo/hanabi/activity-41-71692313
```

#### 7.3 验证翻译效果
检查页面中的日文标签是否已翻译为中文

## 🧪 测试验证步骤

### 测试1：基础翻译功能
- 启动开发服务器
- 访问花火活动详情页
- 检查日文标签是否已翻译

### 测试2：构建测试
```bash
npm run build
```

### 测试3：翻译完整性验证
- 检查所有字段标签翻译是否正确
- 验证回退文本是否生效

## 📋 后续维护指南

### 添加新翻译
1. 在 `messages/zh.json` 中添加新的翻译键值对
2. 在组件中使用 `t('key')` 调用翻译
3. 测试翻译效果

### 扩展到其他模板
1. 在其他模板中导入 `useTranslations`
2. 按相同方式替换硬编码文本
3. 扩展翻译文件内容

## ⚠️ 重要注意事项

1. **渐进式实施**：先完成一个模板的翻译测试
2. **备份原文件**：修改前备份模板文件
3. **构建验证**：每步完成后测试构建
4. **翻译准确性**：确保翻译符合用户习惯

## 🎯 实施建议

### 推荐实施顺序
1. **第一阶段**：安装next-intl，配置基础架构
2. **第二阶段**：修改一个模板测试效果
3. **第三阶段**：扩展到其他模板和页面

---
**文档更新时间**：2025年6月28日  
**技术方案**：next-intl 专业国际化库  
**适用版本**：Next.js 15.3.3 + next-intl 4.3.1  
**实施策略**：专业工具，渐进实施，测试驱动 