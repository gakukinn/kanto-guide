# 0628-Next.jsé¡¹ç›®ä¸­æ–‡ç¿»è¯‘å®æ–½æŒ‡å—

## ğŸ“‹ æ–‡æ¡£ç›®çš„
åŸºäºé¡¹ç›®çœŸå®æ¶æ„ï¼Œæä¾›å‡†ç¡®çš„ä¸­æ–‡ç¿»è¯‘å®æ–½æ­¥éª¤ï¼Œä¼˜å…ˆè§£å†³ä¸­æ–‡ç”¨æˆ·ä½“éªŒé—®é¢˜ã€‚

## ğŸ” é¡¹ç›®çœŸå®ç°çŠ¶åˆ†æï¼ˆå·²é‡æ–°éªŒè¯ï¼‰

### çœŸå®é¡¹ç›®æ¶æ„
- **æŠ€æœ¯æ ˆ**ï¼šNext.js 15.3.3 + TypeScript + TailwindCSS
- **æ•°æ®æº**ï¼š111ä¸ªæ´»åŠ¨JSONæ–‡ä»¶ï¼ˆ`data/activities/` ç›®å½•ï¼Œå·²ç¡®è®¤ï¼‰
- **é¡µé¢ç»“æ„**ï¼šæ··åˆè·¯ç”±ï¼ˆ`app/[locale]` + `app/tokyo|saitama|chiba|kanagawa|kitakanto|koshinetsu`ï¼‰
- **æ„å»ºæ–¹å¼**ï¼šç›®å‰æœªå¯ç”¨é™æ€å¯¼å‡ºï¼ˆ`output: 'export'` è¢«æ³¨é‡Šï¼‰
- **æ•°æ®åº“**ï¼šPrismaå®Œæ•´é…ç½®ä½†æœªåœ¨å®é™…ä»£ç ä¸­ä½¿ç”¨

### åœ°åŒºé…ç½®ï¼ˆåŸºäºregionConfig.tsï¼‰
6ä¸ªåœ°åŒºï¼šä¸œäº¬éƒ½ã€ç¥å¥ˆå·å¿ã€åƒå¶å¿ã€åŸ¼ç‰å¿ã€åŒ—å…³ä¸œã€ç”²ä¿¡è¶Š

### ç°æœ‰ç¿»è¯‘çŠ¶æ€
âœ… **å·²å­˜åœ¨ä½†ä¸å®Œæ•´**ï¼š
- `src/lib/i18n.ts` åŸºç¡€é…ç½®
- ç®€å•çš„ç¿»è¯‘åŠ è½½å‡½æ•°

âŒ **å…³é”®ç¼ºå¤±**ï¼š
- æ²¡æœ‰ä½¿ç”¨ä¸“ä¸šçš„å›½é™…åŒ–åº“
- ä¸­æ–‡ç¿»è¯‘æ–‡ä»¶ä¸å®Œæ•´
- ç»„ä»¶ä¸­æ— ç¿»è¯‘å®ç°

## ğŸš¨ é‡è¦å‘ç°ï¼šå½“å‰ç¿»è¯‘çŠ¶æ€
é¡¹ç›®æœ‰ç¿»è¯‘çš„**åŸºç¡€ç»“æ„**ä½†**æ²¡æœ‰å®é™…ä¸­æ–‡ç¿»è¯‘åŠŸèƒ½**ã€‚

## ğŸ”§ æ¨èæŠ€æœ¯æ–¹æ¡ˆ

### æ–¹æ¡ˆé€‰æ‹©ï¼šnext-intl (æœ€ä½³å®è·µ)

é‡‡ç”¨ **next-intl ä¸“ä¸šå›½é™…åŒ–æ–¹æ¡ˆ**ï¼š
- âœ… ä¸“ä¸ºNext.js App Routerè®¾è®¡
- âœ… åŠŸèƒ½å¼ºå¤§ï¼šæ”¯æŒå¤æ•°ã€å‚æ•°æ’å€¼ã€åŒè¯­æ˜¾ç¤º
- âœ… ç±»å‹å®‰å…¨ï¼šå®Œæ•´TypeScriptæ”¯æŒ
- âœ… æ€§èƒ½ä¼˜ç§€ï¼šæœåŠ¡ç«¯æ¸²æŸ“ä¼˜åŒ–
- âœ… ç¤¾åŒºæ´»è·ƒï¼šGitHub 2.3k+ stars
- âœ… å¿«é€Ÿå®æ–½ï¼Œç«‹å³è§æ•ˆ
- âœ… å®Œå…¨å…¼å®¹ç°æœ‰æ¶æ„

## ğŸ“ è¯¦ç»†å®æ–½æ­¥éª¤ï¼ˆnext-intl 4.3.1ï¼‰

### ç¬¬ä¸€æ­¥ï¼šå®‰è£…next-intl

#### 1.1 å®‰è£…ä¾èµ–
```bash
npm install next-intl
```

#### 1.2 åˆ›å»ºæ­£ç¡®çš„æ–‡ä»¶ç»“æ„
```bash
mkdir -p messages
mkdir -p src/i18n
```

### ç¬¬äºŒæ­¥ï¼šåˆ›å»ºè·¯ç”±é…ç½®

#### 2.1 åˆ›å»º src/i18n/routing.ts
```typescript
import {defineRouting} from 'next-intl/routing';
 
export const routing = defineRouting({
  // æ”¯æŒçš„è¯­è¨€åˆ—è¡¨
  locales: ['zh'],
 
  // é»˜è®¤è¯­è¨€
  defaultLocale: 'zh',
  
  // ä¸ä½¿ç”¨è¯­è¨€å‰ç¼€ (å› ä¸ºé¡¹ç›®åªæœ‰ä¸­æ–‡)
  localePrefix: 'never'
});
```

#### 2.2 åˆ›å»º src/i18n/navigation.ts
```typescript
import {createNavigation} from 'next-intl/navigation';
import {routing} from './routing';
 
// åŸºäºè·¯ç”±é…ç½®çš„å¯¼èˆªAPIåŒ…è£…å™¨
export const {Link, redirect, usePathname, useRouter, getPathname} =
  createNavigation(routing);
```

#### 2.3 åˆ›å»º src/i18n/request.ts
```typescript
import {getRequestConfig} from 'next-intl/server';
import {hasLocale} from 'next-intl';
import {routing} from './routing';
 
export default getRequestConfig(async ({requestLocale}) => {
  // é€šå¸¸å¯¹åº” [locale] æ®µ
  const requested = await requestLocale;
  const locale = hasLocale(routing.locales, requested)
    ? requested
    : routing.defaultLocale;
 
  return {
    locale,
    messages: (await import(`../../messages/${locale}.json`)).default
  };
});
```

### ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºä¸­é—´ä»¶

#### 3.1 åˆ›å»º middleware.ts (æ ¹ç›®å½•)
```typescript
import createMiddleware from 'next-intl/middleware';
import {routing} from './src/i18n/routing';
 
export default createMiddleware(routing);
 
export const config = {
  // åŒ¹é…æ‰€æœ‰è·¯å¾„é™¤äº†apiã€_nextç­‰
  matcher: ['/((?!api|_next|_vercel|.*\\..*).*)']
};
```

### ç¬¬å››æ­¥ï¼šæ›´æ–°Next.jsé…ç½®

#### 4.1 æ›´æ–° next.config.js
```javascript
const createNextIntlPlugin = require('next-intl/plugin');
 
const withNextIntl = createNextIntlPlugin(
  // æŒ‡å®ši18né…ç½®æ–‡ä»¶è·¯å¾„
  './src/i18n/request.ts'
);

/** @type {import('next').NextConfig} */
const nextConfig = {
  // output: 'export', // æš‚æ—¶æ³¨é‡Šï¼Œå®Œæˆç¿»è¯‘åå†å¯ç”¨
  // trailingSlash: true, // æš‚æ—¶æ³¨é‡Š
  images: {
    unoptimized: true,
    remotePatterns: [
      {
        protocol: 'https',
        hostname: 'images.unsplash.com',
      },
      {
        protocol: 'https',
        hostname: 'res.cloudinary.com',
      },
      {
        protocol: 'https',
        hostname: 'i.ytimg.com',
      },
    ],
  },
  // ä¿ç•™ç°æœ‰çš„å…¶ä»–é…ç½®...
};

module.exports = withNextIntl(nextConfig);
```

### ç¬¬äº”æ­¥ï¼šåˆ›å»ºç¿»è¯‘æ–‡ä»¶

#### 5.1 åˆ›å»º messages/zh.json
```json
{
  "navigation": {
    "home": "é¦–é¡µ",
    "activities": "æ´»åŠ¨"
  },
  "regions": {
    "tokyo": "ä¸œäº¬éƒ½",
    "saitama": "åŸ¼ç‰å¿",
    "chiba": "åƒå¶å¿", 
    "kanagawa": "ç¥å¥ˆå·å¿",
    "kitakanto": "åŒ—å…³ä¸œ",
    "koshinetsu": "ç”²ä¿¡è¶Š"
  },
  "activities": {
    "hanabi": "èŠ±ç«å¤§ä¼š",
    "matsuri": "å¤æ—¥ç¥­å…¸",
    "hanami": "èŠ±è§ä¼š",
    "culture": "æ–‡åŒ–è‰ºæœ¯",
    "momiji": "çº¢å¶ç‹©",
    "illumination": "ç¯å…‰ç§€"
  },
  "hanabi": {
    "fireworksCount": "çƒŸèŠ±æ•°é‡",
    "fireworksTime": "ç‡ƒæ”¾æ—¶é—´",
    "expectedVisitors": "é¢„è®¡è§‚ä¼—",
    "date": "ä¸¾åŠæ—¥æœŸ",
    "time": "ä¸¾åŠæ—¶é—´",
    "weatherInfo": "é›¨å¤©å®‰æ’",
    "price": "é—¨ç¥¨ä¿¡æ¯",
    "foodStalls": "å°åƒæ‘Šä½",
    "notes": "å…¶ä»–è¯´æ˜",
    "venue": "ä¸¾åŠåœ°ç‚¹",
    "access": "äº¤é€šæ–¹å¼",
    "parking": "åœè½¦åœº",
    "contact": "è”ç³»æ–¹å¼",
    "highlights": "ç²¾å½©çœ‹ç‚¹",
    "basicInfo": "èŠ±ç«å¤§ä¼šä¿¡æ¯",
    "venueInfo": "ä¼šåœºãƒ»è”ç³»ä¿¡æ¯",
    "activityIntro": "æ´»åŠ¨ç®€ä»‹",
    "locationMap": "ä½ç½®åœ°å›¾"
  },
  "common": {
    "seeOfficial": "è¯¦è§å®˜ç½‘",
    "pleaseCheckOfficial": "è¯·ä»¥å®˜æ–¹ä¿¡æ¯ä¸ºå‡†",
    "noImage": "æš‚æ— å›¾ç‰‡"
  }
}
```

### ç¬¬å…­æ­¥ï¼šä¿®æ”¹æ¨¡æ¿ä½¿ç”¨ç¿»è¯‘

#### 6.1 ä¿®æ”¹ WalkerPlusHanabiTemplate.tsxï¼ˆæµ‹è¯•ï¼‰
```typescript
// åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ å¯¼å…¥
import {useTranslations} from 'next-intl';

export default function WalkerPlusHanabiTemplate({
  data,
  regionKey,
  activityKey,
  regionConfig,
  activityConfig,
}: WalkerPlusHanabiTemplateProps) {
  // æ·»åŠ ç¿»è¯‘hook
  const t = useTranslations('hanabi');
  const tCommon = useTranslations('common');
  
  // ç°æœ‰ä»£ç ...
  
  // ä¿®æ”¹æ ‡ç­¾æ–‡æœ¬ï¼Œä¾‹å¦‚ï¼š
  // åŸæ¥ï¼šè§ã©ã“ã‚
  // æ”¹ä¸ºï¼š{t('highlights')}
  
  // åŸæ¥ï¼šğŸ‡ æ‰“ã¡ä¸Šã’æ•°ï¼š
  // æ”¹ä¸ºï¼šğŸ‡ {t('fireworksCount')}ï¼š
}
```

### ç¬¬ä¸ƒæ­¥ï¼šæµ‹è¯•éªŒè¯

#### 7.1 å¯åŠ¨å¼€å‘æœåŠ¡å™¨æµ‹è¯•
```bash
npm run dev
```

#### 7.2 è®¿é—®æµ‹è¯•é¡µé¢
```
http://localhost:3000/tokyo/hanabi/activity-41-71692313
```

#### 7.3 éªŒè¯ç¿»è¯‘æ•ˆæœ
æ£€æŸ¥é¡µé¢ä¸­çš„æ—¥æ–‡æ ‡ç­¾æ˜¯å¦å·²ç¿»è¯‘ä¸ºä¸­æ–‡

## ğŸ§ª æµ‹è¯•éªŒè¯æ­¥éª¤

### æµ‹è¯•1ï¼šåŸºç¡€ç¿»è¯‘åŠŸèƒ½
- å¯åŠ¨å¼€å‘æœåŠ¡å™¨
- è®¿é—®èŠ±ç«æ´»åŠ¨è¯¦æƒ…é¡µ
- æ£€æŸ¥æ—¥æ–‡æ ‡ç­¾æ˜¯å¦å·²ç¿»è¯‘

### æµ‹è¯•2ï¼šæ„å»ºæµ‹è¯•
```bash
npm run build
```

### æµ‹è¯•3ï¼šç¿»è¯‘å®Œæ•´æ€§éªŒè¯
- æ£€æŸ¥æ‰€æœ‰å­—æ®µæ ‡ç­¾ç¿»è¯‘æ˜¯å¦æ­£ç¡®
- éªŒè¯å›é€€æ–‡æœ¬æ˜¯å¦ç”Ÿæ•ˆ

## ğŸ“‹ åç»­ç»´æŠ¤æŒ‡å—

### æ·»åŠ æ–°ç¿»è¯‘
1. åœ¨ `messages/zh.json` ä¸­æ·»åŠ æ–°çš„ç¿»è¯‘é”®å€¼å¯¹
2. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ `t('key')` è°ƒç”¨ç¿»è¯‘
3. æµ‹è¯•ç¿»è¯‘æ•ˆæœ

### æ‰©å±•åˆ°å…¶ä»–æ¨¡æ¿
1. åœ¨å…¶ä»–æ¨¡æ¿ä¸­å¯¼å…¥ `useTranslations`
2. æŒ‰ç›¸åŒæ–¹å¼æ›¿æ¢ç¡¬ç¼–ç æ–‡æœ¬
3. æ‰©å±•ç¿»è¯‘æ–‡ä»¶å†…å®¹

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

1. **æ¸è¿›å¼å®æ–½**ï¼šå…ˆå®Œæˆä¸€ä¸ªæ¨¡æ¿çš„ç¿»è¯‘æµ‹è¯•
2. **å¤‡ä»½åŸæ–‡ä»¶**ï¼šä¿®æ”¹å‰å¤‡ä»½æ¨¡æ¿æ–‡ä»¶
3. **æ„å»ºéªŒè¯**ï¼šæ¯æ­¥å®Œæˆåæµ‹è¯•æ„å»º
4. **ç¿»è¯‘å‡†ç¡®æ€§**ï¼šç¡®ä¿ç¿»è¯‘ç¬¦åˆç”¨æˆ·ä¹ æƒ¯

## ğŸ¯ å®æ–½å»ºè®®

### æ¨èå®æ–½é¡ºåº
1. **ç¬¬ä¸€é˜¶æ®µ**ï¼šå®‰è£…next-intlï¼Œé…ç½®åŸºç¡€æ¶æ„
2. **ç¬¬äºŒé˜¶æ®µ**ï¼šä¿®æ”¹ä¸€ä¸ªæ¨¡æ¿æµ‹è¯•æ•ˆæœ
3. **ç¬¬ä¸‰é˜¶æ®µ**ï¼šæ‰©å±•åˆ°å…¶ä»–æ¨¡æ¿å’Œé¡µé¢

---
**æ–‡æ¡£æ›´æ–°æ—¶é—´**ï¼š2025å¹´6æœˆ28æ—¥  
**æŠ€æœ¯æ–¹æ¡ˆ**ï¼šnext-intl ä¸“ä¸šå›½é™…åŒ–åº“  
**é€‚ç”¨ç‰ˆæœ¬**ï¼šNext.js 15.3.3 + next-intl 4.3.1  
**å®æ–½ç­–ç•¥**ï¼šä¸“ä¸šå·¥å…·ï¼Œæ¸è¿›å®æ–½ï¼Œæµ‹è¯•é©±åŠ¨ 